<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - LuxeMarket</title>
    <meta name="description" content="View product details, select colors and sizes at LuxeMarket.">

    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style type="text/tailwindcss">
        @layer theme {
        :root {
            --primary-color: #2563EB;
            --primary-hover: #1D4ED8;
            --secondary-color: #F3F4F6;
            --text-main: #111827;
            --text-muted: #6B7280;
            --bg-body: #FFFFFF;
            --accent-color: #F59E0B;
        }
    }

    @layer base {
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
        }
    }

    @layer components {
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .btn {
            @apply inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
        }
        .btn-primary {
            @apply bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)];
        }
        .btn-secondary {
            @apply bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500;
        }
        .container-custom {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
        }
    }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- App Scripts -->
    <script type="text/babel">
        const INITIAL_PRODUCTS = [
            {
                id: 1,
                name: "Premium Wireless Headphones",
                price: 299.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.8,
                reviews: 124,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" },
                    { name: "Navy", hex: "#000080" }
                ],
                sizes: ["One Size"],
                description: "Immerse yourself in pure sound with our active noise-cancelling technology. Features 30-hour battery life and ultra-comfortable ear cushions.",
                images: [
                    "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": [
                        "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1484704849700-f032a568e944?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1524678606370-a47ad25cb82a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Silver": [
                        "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1577174881658-0f30ed549adc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Navy": [
                        "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ]
                }
            },
            {
                id: 2,
                name: "Minimalist Watch Series 5",
                price: 159.50,
                category: "Accessories",
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.6,
                reviews: 89,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Gold", hex: "#FFD700" },
                    { name: "Rose Gold", hex: "#B76E79" }
                ],
                sizes: ["40mm", "44mm"],
                description: "A timeless piece for the modern individual. Features a genuine leather strap, water resistance up to 50m, and a scratch-resistant sapphire crystal glass.",
                images: [
                    "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Gold": "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Rose Gold": "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 3,
                name: "Ergonomic Office Chair",
                price: 499.00,
                category: "Furniture",
                image: "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 215,
                colors: [
                    { name: "Black", hex: "#111827" },
                    { name: "Grey", hex: "#6B7280" },
                    { name: "Blue", hex: "#2563EB" }
                ],
                sizes: ["Standard", "Large"],
                description: "Work in comfort with adjustable lumbar support, 4D armrests, and breathable mesh back. Designed to support your posture during long working hours.",
                images: [
                    "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Grey": "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Blue": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 4,
                name: "Smart Home Speaker",
                price: 89.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.5,
                reviews: 67,
                colors: [
                    { name: "White", hex: "#F3F4F6" },
                    { name: "Black", hex: "#111827" },
                    { name: "Charcoal", hex: "#374151" }
                ],
                sizes: ["Mini", "Standard"],
                description: "Fill your room with rich, 360-degree sound. Compatible with all major voice assistants and features multi-room audio synchronization.",
                images: [
                    "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "White": "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Charcoal": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 5,
                name: "Classic Leather Backpack",
                price: 129.95,
                category: "Fashion",
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.7,
                reviews: 156,
                colors: [
                    { name: "Brown", hex: "#8B4513" },
                    { name: "Black", hex: "#000000" },
                    { name: "Tan", hex: "#D2B48C" }
                ],
                sizes: ["15L", "20L"],
                description: "Handcrafted from full-grain leather that ages beautifully. Features a dedicated laptop compartment and multiple organizer pockets for your daily essentials.",
                images: [
                    "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Brown": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Tan": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 6,
                name: "Digital Camera 4K",
                price: 849.00,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 342,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" }
                ],
                sizes: ["Body Only", "Kit Lens"],
                description: "Capture life's moments in stunning detail. Features a 24MP sensor, 4K video recording, and fast hybrid autofocus system.",
                images: [
                    "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Silver": "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            }
        ];

        const INITIAL_CATEGORIES = [
            "Electronics",
            "Fashion",
            "Furniture",
            "Accessories"
        ];

        const PRODUCT_STORAGE_KEY = 'luxemarket_products';
        const CATEGORY_STORAGE_KEY = 'luxemarket_categories';

        const ProductManager = {
            init: () => {
                if (!localStorage.getItem(PRODUCT_STORAGE_KEY)) {
                    localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(INITIAL_PRODUCTS));
                }
            },

            getAll: () => {
                ProductManager.init();
                try {
                    const raw = localStorage.getItem(PRODUCT_STORAGE_KEY);
                    let stored = JSON.parse(raw) || [];
                    let modified = false;

                    const migrated = stored.map(p => {
                        const initial = INITIAL_PRODUCTS.find(ip => ip.id === p.id);
                        if (initial) {
                            // Backfill variantImages if missing
                            if (!p.variantImages && initial.variantImages) {
                                p.variantImages = initial.variantImages;
                                modified = true;
                            }
                            // Backfill images array if missing or empty
                            if ((!p.images || p.images.length === 0) && initial.images) {
                                p.images = initial.images;
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize variantImages to be arrays
                        if (p.variantImages) {
                            let variantModified = false;
                            Object.keys(p.variantImages).forEach(color => {
                                if (typeof p.variantImages[color] === 'string') {
                                    p.variantImages[color] = [p.variantImages[color]];
                                    variantModified = true;
                                }
                            });
                            if (variantModified) {
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize Colors
                        if (p.colors && p.colors.length > 0) {
                            let colorsModified = false;
                            const normalizedColors = p.colors.map(c => {
                                if (typeof c === 'string') {
                                    colorsModified = true;
                                    const lower = c.toLowerCase();
                                    let hex = '#374151'; // Default gray-700
                                    if (lower === 'black') hex = '#000000';
                                    if (lower === 'white') hex = '#FFFFFF';
                                    if (lower === 'silver') hex = '#C0C0C0';
                                    if (lower === 'gold') hex = '#FFD700';
                                    if (lower === 'navy') hex = '#000080';
                                    if (lower === 'red') hex = '#EF4444';
                                    if (lower === 'blue') hex = '#3B82F6';
                                    if (lower === 'rose gold') hex = '#B76E79';
                                    if (lower === 'grey' || lower === 'gray') hex = '#808080';
                                    if (lower === 'brown') hex = '#8B4513';
                                    if (lower === 'tan') hex = '#D2B48C';

                                    return { name: c, hex: hex };
                                }
                                return c;
                            });
                            if (colorsModified) {
                                p.colors = normalizedColors;
                                modified = true;
                            }
                        }

                        return p;
                    });

                    if (modified) {
                        console.log("Persisting migrated data to localStorage");
                        localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(migrated));
                    }

                    return migrated;
                } catch (e) {
                    console.error("Error loading products from localStorage", e);
                    return INITIAL_PRODUCTS;
                }
            },

            getById: (id) => {
                const products = ProductManager.getAll();
                return products.find(p => p.id === Number(id));
            },

            save: (product) => {
                console.log("ProductManager.save called with:", product);
                const products = ProductManager.getAll();
                if (product.id) {
                    // Update existing
                    const index = products.findIndex(p => p.id === Number(product.id));
                    if (index !== -1) {
                        products[index] = { ...products[index], ...product, id: Number(product.id) };
                        console.log("Updated product at index:", index);
                    } else {
                        console.warn("Product with ID not found for update, adding as new:", product.id);
                        const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                        products.push({ ...product, id: newId, rating: product.rating || 0, reviews: product.reviews || 0 });
                    }
                } else {
                    // Add new
                    const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                    products.push({ ...product, id: newId, rating: 0, reviews: 0 });
                    console.log("Added new product with ID:", newId);
                }
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(products));
                console.log("Saved to localStorage. New count:", products.length);
            },

            delete: (id) => {
                const products = ProductManager.getAll();
                const filtered = products.filter(p => p.id !== id);
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(filtered));
            },

            reorder: (newProducts) => {
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(newProducts));
            }
        };

        const CategoryManager = {
            init: () => {
                if (!localStorage.getItem(CATEGORY_STORAGE_KEY)) {
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(INITIAL_CATEGORIES));
                }
            },

            getAll: () => {
                CategoryManager.init();
                try {
                    return JSON.parse(localStorage.getItem(CATEGORY_STORAGE_KEY)) || INITIAL_CATEGORIES;
                } catch (e) {
                    console.error("Error loading categories", e);
                    return INITIAL_CATEGORIES;
                }
            },

            add: (category) => {
                const categories = CategoryManager.getAll();
                if (!categories.includes(category)) {
                    categories.push(category);
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(categories));
                }
            },

            delete: (category) => {
                const categories = CategoryManager.getAll();
                const filtered = categories.filter(c => c !== category);
                localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(filtered));
            }
        };

        try {
            window.ProductManager = ProductManager;
            window.CategoryManager = CategoryManager;
            console.log("Data Managers initialized");
        } catch (e) {
            console.warn("Could not attach managers to window", e);
        }

        // Export initial products for legacy support if needed, though most uses are via ProductManager
        const PRODUCTS = ProductManager.getAll();
    </script>
    <script type="text/babel">
        const CART_STORAGE_KEY = 'luxemarket_cart';

        const CartManager = {
            getCart: () => {
                try {
                    return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
                } catch (e) {
                    return [];
                }
            },

            addItem: (product, options = {}) => {
                const cart = CartManager.getCart();
                const existingItemIndex = cart.findIndex(item =>
                    item.productId === product.id &&
                    item.options.color === options.color &&
                    item.options.size === options.size
                );

                if (existingItemIndex > -1) {
                    cart[existingItemIndex].quantity += (options.quantity || 1);
                } else {
                    cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.isDailyDeal && product.dealPrice ? product.dealPrice : product.price,
                        image: product.image, // Use main image or specific variant image if passed
                        options: {
                            color: options.color,
                            size: options.size,
                            variantImage: options.variantImage // Store the specific image for the selected color
                        },
                        quantity: options.quantity || 1,
                        addedAt: new Date().toISOString()
                    });
                }

                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            updateQuantity: (index, newQuantity) => {
                const cart = CartManager.getCart();
                if (newQuantity <= 0) {
                    cart.splice(index, 1);
                } else {
                    cart[index].quantity = newQuantity;
                }
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            removeItem: (index) => {
                const cart = CartManager.getCart();
                cart.splice(index, 1);
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            clearCart: () => {
                localStorage.removeItem(CART_STORAGE_KEY);
                window.dispatchEvent(new Event('cart-updated'));
            },

            getCount: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + (Number(item?.quantity) || 0), 0);
            },

            getSubtotal: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + ((Number(item?.price) || 0) * (Number(item?.quantity) || 0)), 0);
            }
        };

        window.CartManager = CartManager;
    </script>
    <script type="text/babel">
        const ToastContext = React.createContext();

        function ToastProvider({ children }) {
            const [toasts, setToasts] = React.useState([]);

            const addToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);

                // Auto remove after 3 seconds
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 3000);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none">
                        {toasts.map(toast => (
                            <div
                                key={toast.id}
                                className={`pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-lg shadow-lg flex items-center justify-between animate-[fadeIn_0.3s_ease-out] ${toast.type === 'success' ? 'bg-gray-900 text-white' :
                                    toast.type === 'error' ? 'bg-red-600 text-white' : 'bg-blue-600 text-white'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <div className={
                                        toast.type === 'success' ? 'icon-circle-check text-xl' :
                                            toast.type === 'error' ? 'icon-circle-alert text-xl' : 'icon-info text-xl'
                                    }></div>
                                    <span className="text-sm font-medium">{toast.message}</span>
                                </div>
                                <button onClick={() => removeToast(toast.id)} className="ml-4 opacity-80 hover:opacity-100">
                                    <div className="icon-x text-sm"></div>
                                </button>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        }

        // Custom hook to use toast
        const useToast = () => {
            const context = React.useContext(ToastContext);
            if (!context) {
                throw new Error('useToast must be used within a ToastProvider');
            }
            return context;
        };
    </script>
    <script type="text/babel">
        function Header({ cartCount, isMenuOpen, setIsMenuOpen, currentUser, onOpenAuth, onLogout }) {
            const [categoryOpen, setCategoryOpen] = React.useState(false);
            const { addToast } = useToast();

            // Clicking outside closes the dropdown
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (categoryOpen && !event.target.closest('.category-dropdown-container')) {
                        setCategoryOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [categoryOpen]);

            const categories = [
                "Electronics", "Fashion", "Furniture", "Accessories",
                "Sporting Goods", "Industrial", "Motors", "Deals"
            ];

            const getCategoryLink = (cat) => `index-portable.html?category=${encodeURIComponent(cat)}#featured-products`;

            const handleComingSoon = (e, feature) => {
                e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            return (
                <header className="font-sans text-sm" data-name="header" data-file="components/Header.js">
                    {/* Top Utility Bar */}
                    <div className="bg-white border-b border-gray-200 py-1 hidden md:block">
                        <div className="container-custom flex justify-between items-center text-xs text-gray-600">
                            <div className="flex items-center gap-4">
                                {currentUser ? (
                                    <span className="flex items-center gap-1">
                                        Hi, <span className="font-bold text-gray-800">{currentUser.name}</span>!
                                        <button onClick={onLogout} className="text-blue-600 hover:underline ml-1">Sign out</button>
                                    </span>
                                ) : (
                                    <span className="flex items-center gap-1">
                                        Hi! <button onClick={() => onOpenAuth(false)} className="text-blue-600 hover:underline">Sign in</button> or <button onClick={() => onOpenAuth(true)} className="text-blue-600 hover:underline">register</button>
                                    </span>
                                )}
                                <a href="index-portable.html?filter=deals#featured-products" className="hover:underline text-[var(--accent-color)] font-medium">Daily Deals</a>
                                <a href="#footer" className="hover:underline">Help & Contact</a>
                            </div>
                            <div className="flex items-center gap-6">
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Shipping selection')} className="hover:underline">Ship to</a>
                                <a href="admin-portable.html" className="hover:underline">Sell</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Watchlist')} className="hover:underline flex items-center gap-1">
                                    Watchlist <div className="icon-chevron-down text-[10px]"></div>
                                </a>
                                <div className="relative group cursor-pointer z-50">
                                    <span className="hover:underline flex items-center gap-1">
                                        My LuxeMarket <div className="icon-chevron-down text-[10px]"></div>
                                    </span>
                                    <div className="absolute right-0 top-full bg-white border border-gray-200 shadow-lg rounded-b-md p-2 hidden group-hover:block w-32">
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Account Summary')} className="block px-2 py-1 hover:bg-gray-100">Summary</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Recently Viewed')} className="block px-2 py-1 hover:bg-gray-100">Recently Viewed</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Bids/Offers')} className="block px-2 py-1 hover:bg-gray-100">Bids/Offers</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Purchase History')} className="block px-2 py-1 hover:bg-gray-100">Purchase History</a>
                                    </div>
                                </div>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Notifications')} className="hover:text-gray-900 relative" title="Notifications">
                                    <div className="icon-bell text-lg"></div>
                                </a>
                                <a href="checkout-portable.html" className="hover:text-gray-900 relative" title="Cart">
                                    <div className="icon-shopping-cart text-lg"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Main Header */}
                    <div className="bg-white py-3 border-b border-gray-200 sticky top-0 z-40 shadow-sm">
                        <div className="container-custom">
                            <div className="flex items-center gap-4">
                                {/* Mobile Menu Button */}
                                <div className="md:hidden">
                                    <button
                                        onClick={() => setIsMenuOpen(!isMenuOpen)}
                                        className="text-gray-500 hover:text-gray-700 p-1"
                                    >
                                        <div className={isMenuOpen ? "icon-x text-2xl" : "icon-menu text-2xl"}></div>
                                    </button>
                                </div>

                                {/* Logo */}
                                <a href="index-portable.html" className="flex-shrink-0 flex items-center gap-1 group">
                                    <div className="icon-shopping-bag text-3xl text-[var(--primary-color)]"></div>
                                    <span className="text-2xl font-bold tracking-tighter text-gray-900">
                                        Luxe<span className="text-[var(--primary-color)]">Market</span>
                                    </span>
                                </a>

                                {/* Shop by Category (Desktop) */}
                                <div className="relative hidden md:block category-dropdown-container">
                                    <button
                                        onClick={() => setCategoryOpen(!categoryOpen)}
                                        className={`text-gray-600 hover:text-gray-900 text-sm font-medium flex items-center gap-1 whitespace-nowrap px-2 py-2 rounded-md transition-colors ${categoryOpen ? 'bg-gray-100' : ''}`}
                                    >
                                        Shop by category <div className={`icon-chevron-down text-xs transition-transform ${categoryOpen ? 'rotate-180' : ''}`}></div>
                                    </button>
                                    {categoryOpen && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white border border-gray-200 shadow-xl rounded-lg p-4 z-50 grid grid-cols-1 gap-2 animate-[fadeIn_0.2s_ease-out]">
                                            {categories.map(cat => (
                                                <a
                                                    key={cat}
                                                    href={getCategoryLink(cat)}
                                                    onClick={() => setCategoryOpen(false)}
                                                    className="hover:text-[var(--primary-color)] hover:underline flex items-center gap-2 p-1 rounded hover:bg-gray-50"
                                                >
                                                    <div className="icon-chevron-right text-xs text-gray-400"></div>
                                                    {cat}
                                                </a>
                                            ))}
                                            <div className="border-t border-gray-100 mt-2 pt-2">
                                                <a href="index-portable.html#featured-products" className="font-bold hover:underline block p-1">See all categories</a>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Search Bar */}
                                <div className="flex-grow flex items-center max-w-4xl mx-auto">
                                    <div className="flex-grow flex border-2 border-gray-300 rounded-full hover:border-gray-400 focus-within:border-[var(--primary-color)] transition-colors h-10 md:h-11 relative bg-gray-100">
                                        <div className="pl-3 flex items-center text-gray-400">
                                            <div className="icon-search text-gray-500"></div>
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Search for anything"
                                            className="flex-grow px-3 bg-transparent border-none focus:outline-none text-gray-900 placeholder-gray-500 w-full"
                                        />
                                        {/* Category Select inside Search (Desktop) */}
                                        <div className="hidden md:flex items-center border-l border-gray-300 px-3">
                                            <select className="bg-transparent text-gray-600 text-sm focus:outline-none cursor-pointer max-w-[120px] truncate">
                                                <option>All Categories</option>
                                                {categories.map(cat => <option key={cat}>{cat}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <button className="btn btn-primary rounded-full px-6 ml-2 h-10 md:h-11 text-base font-semibold min-w-[100px] hidden md:block hover:shadow-md transition-shadow">
                                        Search
                                    </button>
                                </div>

                                <a href="#" onClick={(e) => handleComingSoon(e, 'Advanced Search')} className="text-xs text-gray-500 hover:text-gray-700 whitespace-nowrap hidden lg:block">Advanced</a>

                                {/* Mobile Cart Icon */}
                                <a href="checkout-portable.html" className="md:hidden relative text-gray-600">
                                    <div className="icon-shopping-cart text-2xl"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Nav Bar */}
                    <div className="border-b border-gray-200 bg-white hidden md:block">
                        <div className="container-custom">
                            <nav className="flex items-center justify-center gap-6 py-2 text-[13px] text-gray-600">
                                <a href="index-portable.html" className="hover:text-[var(--primary-color)] font-medium border-b-2 border-transparent hover:border-[var(--primary-color)] pb-1 transition-colors">Home</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Saved Items')} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors flex items-center gap-1">
                                    <div className="icon-heart text-xs"></div> Saved
                                </a>
                                {categories.slice(0, 6).map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors">{cat}</a>
                                ))}
                                <a href="admin-portable.html" className="text-[var(--primary-color)] hover:underline flex items-center gap-1 ml-4 border-l pl-4 border-gray-300">
                                    <div className="icon-shield-check text-xs"></div> Admin Panel
                                </a>
                            </nav>
                        </div>
                    </div>

                    {/* Mobile Menu Overlay */}
                    {isMenuOpen && (
                        <div className="md:hidden bg-white border-b border-gray-200 shadow-xl absolute w-full z-50 max-h-[80vh] overflow-y-auto">
                            <div className="p-4 flex flex-col space-y-4">
                                <div className="font-bold text-lg mb-2 flex justify-between items-center">
                                    Categories
                                    <button onClick={() => setIsMenuOpen(false)} className="text-gray-400"><div className="icon-x text-xl"></div></button>
                                </div>
                                {categories.map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="text-gray-700 py-1 border-b border-gray-50 pl-2">{cat}</a>
                                ))}
                                <div className="font-bold text-lg mt-4 mb-2">My Account</div>

                                {currentUser ? (
                                    <>
                                        <div className="text-gray-700 py-1 pl-2">Hi, {currentUser.name}</div>
                                        <button onClick={onLogout} className="text-left text-gray-700 py-1 pl-2">Sign Out</button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(false); }} className="text-left text-gray-700 py-1 pl-2">Sign In</button>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(true); }} className="text-left text-gray-700 py-1 pl-2">Register</button>
                                    </>
                                )}

                                <a href="admin-portable.html" className="text-[var(--primary-color)] font-medium py-1 mt-2 pl-2">Admin Dashboard</a>
                            </div>
                        </div>
                    )}
                </header>
            );
        }
    </script>
    <script type="text/babel">
        function Footer() {
            const currentYear = new Date().getFullYear();
            const { addToast } = useToast();

            const handleComingSoon = (e, feature) => {
                if (e) e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            const linkGroups = [
                {
                    title: "Buy",
                    links: ["Registration", "Money Back Guarantee", "Bidding & buying help", "Stores", "Charity Shop", "Seasonal Sales"]
                },
                {
                    title: "Sell",
                    links: ["Start selling", "Learn to sell", "Affiliates", "Seller Information Center"]
                },
                {
                    title: "Stay Connected",
                    links: ["LuxeMarket Blog", "Facebook", "Twitter", "Instagram", "Pinterest"]
                },
                {
                    title: "About LuxeMarket",
                    links: ["Company Info", "News", "Investors", "Careers", "Government Relations", "Advertise with us", "Policies"]
                },
                {
                    title: "Help & Contact",
                    links: ["Seller Information Center", "Contact Us", "Resolution Center", "Returns", "Shipping"]
                }
            ];

            return (
                <footer className="bg-white border-t border-gray-200 pt-12 pb-6 text-[13px]" data-name="footer" data-file="components/Footer.js">
                    <div className="container-custom">
                        {/* Main Links Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8 mb-12">
                            {linkGroups.map((group, idx) => (
                                <div key={idx}>
                                    <h3 className="font-bold text-gray-700 mb-4">{group.title}</h3>
                                    <ul className="space-y-2">
                                        {group.links.map(link => (
                                            <li key={link}>
                                                <a href="#" onClick={(e) => handleComingSoon(e, link)} className="text-gray-600 hover:text-[var(--primary-color)] hover:underline transition-colors block">
                                                    {link}
                                                </a>
                                            </li>
                                        ))}
                                    </ul>
                                    {group.title === "Stay Connected" && (
                                        <div className="flex gap-3 mt-4">
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Facebook')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-blue-600 hover:text-white transition-colors">
                                                <div className="icon-facebook text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Twitter')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-sky-400 hover:text-white transition-colors">
                                                <div className="icon-twitter text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Instagram')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-pink-600 hover:text-white transition-colors">
                                                <div className="icon-instagram text-sm"></div>
                                            </a>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* Bottom Section */}
                        <div className="border-t border-gray-200 pt-8">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-500">
                                <div className="flex flex-wrap justify-center md:justify-start gap-4 mb-2 md:mb-0">
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Accessibility')} className="hover:underline">Accessibility</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'User Agreement')} className="hover:underline">User Agreement</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Privacy')} className="hover:underline">Privacy</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Payments Terms of Use')} className="hover:underline">Payments Terms of Use</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Cookies')} className="hover:underline">Cookies</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Individual Privacy Rights')} className="hover:underline">Do not sell my personal info</a>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span>Copyright Â© 1995-{currentYear} LuxeMarket Inc. All Rights Reserved.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
            );
        }
    </script>
    <script type="text/babel">
        function Newsletter() {
            const { addToast } = useToast();

            const handleSubmit = (e) => {
                e.preventDefault();
                addToast('Thanks for subscribing! Keep an eye on your inbox.', 'success');
                e.target.reset();
            };

            return (
                <div className="bg-[var(--primary-color)] py-16" data-name="newsletter" data-file="components/Newsletter.js">
                    <div className="container-custom">
                        <div className="flex flex-col md:flex-row items-center justify-between gap-8">
                            <div className="text-white max-w-lg">
                                <h2 className="text-3xl font-bold mb-4">Subscribe to our newsletter</h2>
                                <p className="text-blue-100 text-lg">
                                    Get the latest updates on new products and upcoming sales directly in your inbox.
                                </p>
                            </div>

                            <div className="w-full max-w-md">
                                <form className="flex flex-col sm:flex-row gap-3" onSubmit={handleSubmit}>
                                    <input
                                        type="email"
                                        placeholder="Enter your email address"
                                        className="flex-grow px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300"
                                        required
                                    />
                                    <button type="submit" className="bg-gray-900 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-800 transition-colors shadow-lg">
                                        Subscribe
                                    </button>
                                </form>
                                <div className="text-blue-200 text-sm mt-3 flex items-center gap-1">
                                    <div className="icon-lock text-xs"></div>
                                    Your email is safe with us. No spam.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function ProductDetail({ product, onAddToCart }) {
            const { addToast } = useToast();
            const isDeal = product.isDailyDeal;
            const finalPrice = isDeal && product.dealPrice ? product.dealPrice : product.price;

            // Helper to get color name safely
            const getColorName = (c) => typeof c === 'string' ? c : c.name;
            const getColorHex = (c) => typeof c === 'string' ? c : c.hex;

            // Initialize with first available options if they exist
            const [selectedColor, setSelectedColor] = React.useState(product.colors && product.colors.length > 0 ? getColorName(product.colors[0]) : null);
            const [selectedSize, setSelectedSize] = React.useState(product.sizes ? product.sizes[0] : null);
            const [quantity, setQuantity] = React.useState(1);

            const [activeImage, setActiveImage] = React.useState(product.image);

            // If we have a gallery, combine main image + gallery images
            // This is the default if no color-specific images are found
            const defaultImages = React.useMemo(() => {
                const imgs = [product.image];
                if (product.images && product.images.length > 0) {
                    product.images.forEach(img => {
                        if (!imgs.includes(img)) imgs.push(img);
                    });
                }
                return imgs;
            }, [product]);

            // Current images based on selected color
            const currentImages = React.useMemo(() => {
                if (!selectedColor || !product.variantImages) return defaultImages;

                let variantImgs = null;

                // Direct match
                if (product.variantImages[selectedColor]) {
                    variantImgs = product.variantImages[selectedColor];
                } else {
                    // Case-insensitive match
                    const match = Object.keys(product.variantImages).find(
                        k => k.toLowerCase() === selectedColor.toLowerCase()
                    );
                    if (match) {
                        variantImgs = product.variantImages[match];
                    }
                }

                if (variantImgs) {
                    return Array.isArray(variantImgs) ? variantImgs : [variantImgs];
                }

                return defaultImages;
            }, [selectedColor, product, defaultImages]);

            // Effect: reset active image when color changes (to the first image of the new set)
            React.useEffect(() => {
                if (currentImages.length > 0) {
                    setActiveImage(currentImages[0]);
                }
            }, [currentImages]);

            const handleImageClick = (img) => {
                setActiveImage(img);

                let targetColor = null;

                // 1. Check explicit variant mappings
                if (product.variantImages) {
                    const matchedColorKey = Object.keys(product.variantImages).find(
                        color => product.variantImages[color] === img
                    );
                    if (matchedColorKey) {
                        targetColor = matchedColorKey;
                    }
                }

                // 2. Fallback: If no mapping found, and this is the main image
                if (!targetColor && img === product.image && product.colors && product.colors.length > 0) {
                    targetColor = getColorName(product.colors[0]);
                }

                if (targetColor && product.colors) {
                    // Find valid color option
                    const availableColor = product.colors.find(
                        c => getColorName(c).toLowerCase() === targetColor.toLowerCase()
                    );
                    if (availableColor) {
                        setSelectedColor(getColorName(availableColor));
                    }
                }
            };

            const handleAddToCart = () => {
                onAddToCart(product, {
                    color: selectedColor,
                    size: selectedSize,
                    quantity: quantity
                });
            };

            return (
                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden" data-name="product-detail" data-file="components/ProductDetail.js">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-0">
                        {/* Image Section */}
                        <div className="bg-gray-100 p-8 flex flex-col items-center justify-center min-h-[500px] lg:min-h-[700px] relative">
                            <div className="flex-grow flex items-center justify-center w-full mb-6 py-4">
                                <img
                                    key={activeImage}
                                    src={activeImage}
                                    alt={product.name}
                                    className="max-w-full max-h-[500px] object-contain mix-blend-multiply transition-all duration-300 animate-[fadeIn_0.3s_ease-out]"
                                />
                            </div>

                            {/* Carousel Thumbnails */}
                            {currentImages.length > 1 && (
                                <div className="flex gap-4 overflow-x-auto max-w-full pb-4 px-2 scrollbar-hide">
                                    {currentImages.map((img, index) => (
                                        <button
                                            key={`${selectedColor}-${index}`}
                                            onClick={() => handleImageClick(img)}
                                            onMouseEnter={() => handleImageClick(img)}
                                            className={`flex-shrink-0 w-20 h-20 md:w-24 md:h-24 rounded-lg border-2 overflow-hidden bg-white transition-all shadow-sm ${activeImage === img ? 'border-[var(--primary-color)] ring-2 ring-[var(--primary-color)] ring-opacity-30 scale-105' : 'border-transparent hover:border-gray-300'}`}
                                        >
                                            <img src={img} alt={`View ${index + 1}`} className="w-full h-full object-cover" />
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* Info Section */}
                        <div className="p-8 lg:p-12 flex flex-col">
                            <div className="mb-2">
                                <a
                                    href={`index-portable.html?category=${encodeURIComponent(product.category)}#featured-products`}
                                    className="text-sm font-medium text-[var(--primary-color)] tracking-wider uppercase hover:underline"
                                >
                                    {product.category}
                                </a>
                            </div>
                            <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{product.name}</h1>

                            <div className="flex items-center gap-4 mb-6">
                                <div className="flex items-baseline gap-2">
                                    {isDeal && product.dealPrice ? (
                                        <>
                                            <span className="text-3xl font-bold text-red-600">${product.dealPrice.toFixed(2)}</span>
                                            <span className="text-xl text-gray-400 line-through">${product.price.toFixed(2)}</span>
                                            <span className="bg-red-100 text-red-800 text-xs font-bold px-2 py-1 rounded-full uppercase tracking-wide">
                                                Save {Math.round(((product.price - product.dealPrice) / product.price) * 100)}%
                                            </span>
                                        </>
                                    ) : (
                                        <span className="text-3xl font-bold text-gray-900">${product.price.toFixed(2)}</span>
                                    )}
                                </div>

                                <div className="flex items-center gap-1 border-l pl-4 border-gray-200">
                                    <div className="flex text-yellow-400 text-sm">
                                        {[...Array(5)].map((_, i) => (
                                            <div key={i} className={`icon-star ${i < Math.floor(product.rating) ? 'fill-current' : 'text-gray-300'}`}></div>
                                        ))}
                                    </div>
                                    <span className="text-sm text-gray-500 ml-1">({product.reviews} reviews)</span>
                                </div>
                            </div>

                            <p className="text-gray-600 leading-relaxed mb-8">
                                {product.description || "Experience premium quality with this meticulously crafted item."}
                            </p>

                            <hr className="border-gray-100 mb-8" />

                            {/* Options */}
                            <div className="space-y-6 mb-8">
                                {/* Colors */}
                                {product.colors && product.colors.length > 0 && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-900 mb-3">Color</label>
                                        <div className="flex items-center gap-3">
                                            {product.colors.map((colorObj) => {
                                                const colorName = getColorName(colorObj);
                                                const colorHex = getColorHex(colorObj);
                                                const isSelected = selectedColor === colorName;

                                                return (
                                                    <button
                                                        key={colorName}
                                                        onClick={() => setSelectedColor(colorName)}
                                                        className={`w-12 h-12 rounded-full border-2 flex items-center justify-center transition-all ${isSelected ? 'border-[var(--primary-color)] ring-2 ring-[var(--primary-color)] ring-offset-2 scale-110' : 'border-gray-200 hover:border-gray-300 hover:scale-105'}`}
                                                        title={colorName}
                                                    >
                                                        <span
                                                            className="w-9 h-9 rounded-full border border-gray-100 shadow-inner relative"
                                                            style={{ backgroundColor: colorHex }}
                                                        >
                                                            {/* Optional: Add checkmark for selected white/light colors */}
                                                            {isSelected && ['#ffffff', '#fff', 'white'].includes(colorHex.toLowerCase()) && (
                                                                <div className="absolute inset-0 flex items-center justify-center">
                                                                    <div className="icon-check text-gray-900 text-sm"></div>
                                                                </div>
                                                            )}
                                                        </span>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                        <p className="text-sm text-gray-500 mt-2">Selected: <span className="font-medium text-gray-900 capitalize">{selectedColor}</span></p>
                                    </div>
                                )}

                                {/* Sizes */}
                                {product.sizes && product.sizes.length > 0 && (
                                    <div>
                                        <div className="flex items-center justify-between mb-3">
                                            <label className="block text-sm font-medium text-gray-900">Size</label>
                                            <button onClick={() => addToast('Size guide coming soon!', 'info')} className="text-sm text-[var(--primary-color)] hover:underline">Size Guide</button>
                                        </div>
                                        <div className="flex flex-wrap gap-3">
                                            {product.sizes.map((size) => (
                                                <button
                                                    key={size}
                                                    onClick={() => setSelectedSize(size)}
                                                    className={`min-w-[3rem] h-10 px-3 rounded-md border font-medium text-sm transition-all ${selectedSize === size
                                                        ? 'bg-gray-900 text-white border-gray-900'
                                                        : 'bg-white text-gray-700 border-gray-200 hover:border-gray-300 hover:bg-gray-50'
                                                        }`}
                                                >
                                                    {size}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Actions */}
                            <div className="mt-auto pt-6 border-t border-gray-100">
                                <div className="flex flex-col sm:flex-row gap-4">
                                    {/* Quantity */}
                                    <div className="flex items-center border border-gray-300 rounded-md w-max">
                                        <button
                                            onClick={() => setQuantity(Math.max(1, quantity - 1))}
                                            className="px-3 py-2 text-gray-600 hover:bg-gray-100 transition-colors"
                                        >
                                            <div className="icon-minus text-sm"></div>
                                        </button>
                                        <span className="w-12 text-center font-medium text-gray-900">{quantity}</span>
                                        <button
                                            onClick={() => setQuantity(quantity + 1)}
                                            className="px-3 py-2 text-gray-600 hover:bg-gray-100 transition-colors"
                                        >
                                            <div className="icon-plus text-sm"></div>
                                        </button>
                                    </div>

                                    <button
                                        onClick={handleAddToCart}
                                        className="flex-1 btn btn-primary py-3 text-lg shadow-lg shadow-blue-500/20"
                                    >
                                        <div className="icon-shopping-cart mr-2"></div>
                                        Add to Cart - ${(finalPrice * quantity).toFixed(2)}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function AuthModal({ isOpen, onClose, onLogin }) {
            const [isRegistering, setIsRegistering] = React.useState(false);
            const [formData, setFormData] = React.useState({
                name: '',
                email: '',
                password: ''
            });

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                // Mock authentication
                const user = {
                    name: isRegistering ? formData.name : (formData.email.split('@')[0] || 'User'),
                    email: formData.email
                };

                // Save mock session
                localStorage.setItem('luxemarket_user', JSON.stringify(user));

                onLogin(user);
                onClose();
                setFormData({ name: '', email: '', password: '' });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] animate-[fadeIn_0.2s_ease-out]">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden relative" onClick={e => e.stopPropagation()}>
                        <button
                            onClick={onClose}
                            className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
                        >
                            <div className="icon-x text-xl"></div>
                        </button>

                        <div className="p-8">
                            <div className="text-center mb-6">
                                <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-[var(--primary-color)] mb-4">
                                    <div className="icon-user text-2xl"></div>
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900">
                                    {isRegistering ? 'Create Account' : 'Welcome Back'}
                                </h2>
                                <p className="text-gray-500 text-sm mt-1">
                                    {isRegistering ? 'Join us for exclusive deals' : 'Sign in to continue shopping'}
                                </p>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                {isRegistering && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={formData.name}
                                            onChange={e => setFormData({ ...formData, name: e.target.value })}
                                        />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                    <input
                                        type="email"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.email}
                                        onChange={e => setFormData({ ...formData, email: e.target.value })}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input
                                        type="password"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.password}
                                        onChange={e => setFormData({ ...formData, password: e.target.value })}
                                    />
                                </div>

                                <button type="submit" className="w-full btn btn-primary py-2.5 mt-2">
                                    {isRegistering ? 'Register' : 'Sign In'}
                                </button>
                            </form>

                            <div className="mt-6 text-center text-sm">
                                <span className="text-gray-500">
                                    {isRegistering ? 'Already have an account?' : 'New to LuxeMarket?'}
                                </span>
                                <button
                                    onClick={() => setIsRegistering(!isRegistering)}
                                    className="text-[var(--primary-color)] font-medium hover:underline ml-1"
                                >
                                    {isRegistering ? 'Sign In' : 'Create account'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        // Important: DO NOT remove this `ErrorBoundary` component.
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ErrorBoundary caught an error:', error, errorInfo.componentStack);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50">
                            <div className="text-center p-8">
                                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4">
                                    <div className="icon-triangle-alert text-2xl text-red-600"></div>
                                </div>
                                <h1 className="text-2xl font-bold text-gray-900 mb-4">Something went wrong</h1>
                                <p className="text-gray-600 mb-6">We encountered an unexpected error. Please try reloading.</p>
                                <button
                                    onClick={() => window.location.reload()}
                                    className="btn btn-primary"
                                >
                                    Reload Page
                                </button>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        function ProductApp() {
            const [cartCount, setCartCount] = React.useState(0);
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [currentProduct, setCurrentProduct] = React.useState(null);

            // Auth State
            const [currentUser, setCurrentUser] = React.useState(null);
            const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);

            const { addToast } = useToast();

            React.useEffect(() => {
                // Load User
                const savedUser = localStorage.getItem('luxemarket_user');
                if (savedUser) {
                    setCurrentUser(JSON.parse(savedUser));
                }

                // Parse query parameter for product ID
                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                if (id) {
                    const foundProduct = window.ProductManager.getById(id);
                    if (foundProduct) {
                        setCurrentProduct(foundProduct);
                        document.title = `${foundProduct.name} - LuxeMarket`;
                    }
                }

                // Initial Cart Count
                setCartCount(window.CartManager.getCount());

                // Listen for cart changes
                const handleCartUpdate = () => {
                    setCartCount(window.CartManager.getCount());
                };
                window.addEventListener('cart-updated', handleCartUpdate);
                return () => window.removeEventListener('cart-updated', handleCartUpdate);

            }, []);

            const addToCart = (product, options) => {
                // Auth Check
                if (!currentUser) {
                    setIsAuthModalOpen(true);
                    return;
                }

                // Add to Real Cart
                // Also store the variant image if we can resolve it from options
                // (This logic is partly in ProductDetail, but we can enhance CartManager logic too)
                // For now we pass what we have. ProductDetail sends the right color.

                // We need to resolve the image for the cart item based on color if not passed
                // But ProductDetail handles UI image switch. 
                // Let's rely on ProductDetail to pass specific image if needed, or CartManager resolves it.
                // Simpler: Just pass basic options for now.

                // Wait, let's grab the current active image from the ProductDetail component? 
                // Easier way: The ProductDetail passes 'options' which includes color. 
                // Let's look up the variant image in CartManager or here.

                let variantImage = null;
                if (options.color && product.variantImages && product.variantImages[options.color]) {
                    const vImgs = product.variantImages[options.color];
                    variantImage = Array.isArray(vImgs) ? vImgs[0] : vImgs;
                }

                window.CartManager.addItem(product, { ...options, variantImage });

                addToast(`Added ${product.name} to cart`, 'success');
            };

            const handleLogin = (user) => {
                setCurrentUser(user);
                addToast(`Welcome back, ${user.name}!`, 'success');
            };

            const handleLogout = () => {
                localStorage.removeItem('luxemarket_user');
                setCurrentUser(null);
                addToast('Successfully logged out', 'info');
                setTimeout(() => window.location.reload(), 1000);
            };

            try {
                return (
                    <div className="min-h-screen flex flex-col" data-name="product-app-container" data-file="product-app.js">
                        <Header
                            cartCount={cartCount}
                            isMenuOpen={isMenuOpen}
                            setIsMenuOpen={setIsMenuOpen}
                            currentUser={currentUser}
                            onOpenAuth={() => setIsAuthModalOpen(true)}
                            onLogout={handleLogout}
                        />

                        <main className="flex-grow bg-gray-50 py-12">
                            <div className="container-custom">
                                {currentProduct ? (
                                    <ProductDetail product={currentProduct} onAddToCart={addToCart} />
                                ) : (
                                    <div className="text-center py-24">
                                        <div className="icon-loader animate-spin text-4xl text-[var(--primary-color)] mx-auto mb-4"></div>
                                        <p className="text-gray-500">Loading product details...</p>
                                        <a href="index-portable.html" className="text-[var(--primary-color)] hover:underline mt-4 inline-block">Return to Home</a>
                                    </div>
                                )}
                            </div>
                            <div className="mt-16">
                                <Newsletter />
                            </div>
                        </main>

                        <Footer />

                        <AuthModal
                            isOpen={isAuthModalOpen}
                            onClose={() => setIsAuthModalOpen(false)}
                            onLogin={handleLogin}
                        />
                    </div>
                );
            } catch (error) {
                console.error('ProductApp component error:', error);
                return null;
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <ToastProvider>
                    <ProductApp />
                </ToastProvider>
            </ErrorBoundary>
        );
    </script>
</body>

</html>