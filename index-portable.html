<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxeMarket - Premium E-Commerce</title>
    <meta name="description"
        content="Discover premium products at LuxeMarket. Shop the latest trends in fashion, electronics, and home decor.">
    <meta name="keywords" content="shopping, e-commerce, premium, fashion, electronics">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Open Graph -->
    <meta property="og:title" content="LuxeMarket - Premium E-Commerce">
    <meta property="og:description" content="Discover premium products at LuxeMarket.">

    <!-- Twitter -->
    <meta name="twitter:title" content="LuxeMarket - Premium E-Commerce">
    <meta name="twitter:description" content="Discover premium products at LuxeMarket.">

    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style type="text/tailwindcss">
        @layer theme {
        :root {
            --primary-color: #2563EB;
            --primary-hover: #1D4ED8;
            --secondary-color: #F3F4F6;
            --text-main: #111827;
            --text-muted: #6B7280;
            --bg-body: #FFFFFF;
            --accent-color: #F59E0B;
        }
    }

    @layer base {
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
        }
    }

    @layer components {
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }
        .btn:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px currentColor;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: #ffffff;
            border: 1px solid transparent;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
        .btn-primary:focus {
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px var(--primary-color);
        }
        .btn-secondary {
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #f9fafb;
        }
        .btn-secondary:focus {
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px #6b7280;
        }
        .btn-ghost {
            background-color: transparent;
            color: #4b5563;
        }
        .btn-ghost:hover {
            background-color: #f3f4f6;
        }
        .container-custom {
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        @media (min-width: 640px) {
            .container-custom { padding-left: 1.5rem; padding-right: 1.5rem; }
        }
        @media (min-width: 1024px) {
            .container-custom { padding-left: 2rem; padding-right: 2rem; }
        }
        @keyframes zoomIn {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        .animate-zoom {
            animation: zoomIn 20s linear infinite alternate;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- App Scripts (Inlined for Portability) -->
    <script type="text/babel">
        const INITIAL_PRODUCTS = [
            {
                id: 1,
                name: "Premium Wireless Headphones",
                price: 299.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.8,
                reviews: 124,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" },
                    { name: "Navy", hex: "#000080" }
                ],
                sizes: ["One Size"],
                description: "Immerse yourself in pure sound with our active noise-cancelling technology. Features 30-hour battery life and ultra-comfortable ear cushions.",
                images: [
                    "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": [
                        "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1484704849700-f032a568e944?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1524678606370-a47ad25cb82a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Silver": [
                        "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1577174881658-0f30ed549adc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Navy": [
                        "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ]
                }
            },
            {
                id: 2,
                name: "Minimalist Watch Series 5",
                price: 159.50,
                category: "Accessories",
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.6,
                reviews: 89,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Gold", hex: "#FFD700" },
                    { name: "Rose Gold", hex: "#B76E79" }
                ],
                sizes: ["40mm", "44mm"],
                description: "A timeless piece for the modern individual. Features a genuine leather strap, water resistance up to 50m, and a scratch-resistant sapphire crystal glass.",
                images: [
                    "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Gold": "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Rose Gold": "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 3,
                name: "Ergonomic Office Chair",
                price: 499.00,
                category: "Furniture",
                image: "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 215,
                colors: [
                    { name: "Black", hex: "#111827" },
                    { name: "Grey", hex: "#6B7280" },
                    { name: "Blue", hex: "#2563EB" }
                ],
                sizes: ["Standard", "Large"],
                description: "Work in comfort with adjustable lumbar support, 4D armrests, and breathable mesh back. Designed to support your posture during long working hours.",
                images: [
                    "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Grey": "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Blue": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 4,
                name: "Smart Home Speaker",
                price: 89.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.5,
                reviews: 67,
                colors: [
                    { name: "White", hex: "#F3F4F6" },
                    { name: "Black", hex: "#111827" },
                    { name: "Charcoal", hex: "#374151" }
                ],
                sizes: ["Mini", "Standard"],
                description: "Fill your room with rich, 360-degree sound. Compatible with all major voice assistants and features multi-room audio synchronization.",
                images: [
                    "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "White": "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Charcoal": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 5,
                name: "Classic Leather Backpack",
                price: 129.95,
                category: "Fashion",
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.7,
                reviews: 156,
                colors: [
                    { name: "Brown", hex: "#8B4513" },
                    { name: "Black", hex: "#000000" },
                    { name: "Tan", hex: "#D2B48C" }
                ],
                sizes: ["15L", "20L"],
                description: "Handcrafted from full-grain leather that ages beautifully. Features a dedicated laptop compartment and multiple organizer pockets for your daily essentials.",
                images: [
                    "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Brown": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Tan": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 6,
                name: "Digital Camera 4K",
                price: 849.00,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 342,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" }
                ],
                sizes: ["Body Only", "Kit Lens"],
                description: "Capture life's moments in stunning detail. Features a 24MP sensor, 4K video recording, and fast hybrid autofocus system.",
                images: [
                    "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Silver": "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            }
        ];

        const INITIAL_CATEGORIES = [
            "Electronics",
            "Fashion",
            "Furniture",
            "Accessories",
            "Sporting Goods",
            "Industrial",
            "Motors",
            "Deals"
        ];

        const PRODUCT_STORAGE_KEY = 'luxemarket_products';
        const CATEGORY_STORAGE_KEY = 'luxemarket_categories';
        const CURRENT_DATA_VERSION = 'v1.3'; // Increment this to force a reset for all users

        const ProductManager = {
            init: () => {
                const storedVersion = localStorage.getItem('luxemarket_data_version');
                if (!localStorage.getItem(PRODUCT_STORAGE_KEY) || storedVersion !== CURRENT_DATA_VERSION) {
                    console.log("Initializing/Resetting data to version:", CURRENT_DATA_VERSION);
                    localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(INITIAL_PRODUCTS));
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(INITIAL_CATEGORIES));
                    localStorage.setItem('luxemarket_data_version', CURRENT_DATA_VERSION);
                }
            },

            getAll: () => {
                ProductManager.init();
                try {
                    const raw = localStorage.getItem(PRODUCT_STORAGE_KEY);
                    let stored = JSON.parse(raw) || [];
                    let modified = false;

                    const migrated = stored.map(p => {
                        const initial = INITIAL_PRODUCTS.find(ip => ip.id === p.id);
                        if (initial) {
                            // Backfill variantImages if missing
                            if (!p.variantImages && initial.variantImages) {
                                p.variantImages = initial.variantImages;
                                modified = true;
                            }
                            // Backfill images array if missing or empty
                            if ((!p.images || p.images.length === 0) && initial.images) {
                                p.images = initial.images;
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize variantImages to be arrays
                        if (p.variantImages) {
                            let variantModified = false;
                            Object.keys(p.variantImages).forEach(color => {
                                if (typeof p.variantImages[color] === 'string') {
                                    p.variantImages[color] = [p.variantImages[color]];
                                    variantModified = true;
                                }
                            });
                            if (variantModified) {
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize Colors
                        if (p.colors && p.colors.length > 0) {
                            let colorsModified = false;
                            const normalizedColors = p.colors.map(c => {
                                if (typeof c === 'string') {
                                    colorsModified = true;
                                    const lower = c.toLowerCase();
                                    let hex = '#374151'; // Default gray-700
                                    if (lower === 'black') hex = '#000000';
                                    if (lower === 'white') hex = '#FFFFFF';
                                    if (lower === 'silver') hex = '#C0C0C0';
                                    if (lower === 'gold') hex = '#FFD700';
                                    if (lower === 'navy') hex = '#000080';
                                    if (lower === 'red') hex = '#EF4444';
                                    if (lower === 'blue') hex = '#3B82F6';
                                    if (lower === 'rose gold') hex = '#B76E79';
                                    if (lower === 'grey' || lower === 'gray') hex = '#808080';
                                    if (lower === 'brown') hex = '#8B4513';
                                    if (lower === 'tan') hex = '#D2B48C';

                                    return { name: c, hex: hex };
                                }
                                return c;
                            });
                            if (colorsModified) {
                                p.colors = normalizedColors;
                                modified = true;
                            }
                        }

                        return p;
                    });

                    if (modified) {
                        console.log("Persisting migrated data to localStorage");
                        localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(migrated));
                    }

                    return migrated;
                } catch (e) {
                    console.error("Error loading products from localStorage", e);
                    return INITIAL_PRODUCTS;
                }
            },

            getById: (id) => {
                const products = ProductManager.getAll();
                return products.find(p => p.id === Number(id));
            },

            save: (product) => {
                console.log("ProductManager.save called with:", product);
                const products = ProductManager.getAll();
                if (product.id) {
                    // Update existing
                    const index = products.findIndex(p => p.id === Number(product.id));
                    if (index !== -1) {
                        products[index] = { ...products[index], ...product, id: Number(product.id) };
                        console.log("Updated product at index:", index);
                    } else {
                        console.warn("Product with ID not found for update, adding as new:", product.id);
                        const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                        products.push({ ...product, id: newId, rating: product.rating || 0, reviews: product.reviews || 0 });
                    }
                } else {
                    // Add new
                    const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                    products.push({ ...product, id: newId, rating: 0, reviews: 0 });
                    console.log("Added new product with ID:", newId);
                }
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(products));
                console.log("Saved to localStorage. New count:", products.length);
            },

            delete: (id) => {
                const products = ProductManager.getAll();
                const filtered = products.filter(p => p.id !== id);
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(filtered));
            },

            reorder: (newProducts) => {
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(newProducts));
            }
        };

        const CategoryManager = {
            init: () => {
                if (!localStorage.getItem(CATEGORY_STORAGE_KEY)) {
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(INITIAL_CATEGORIES));
                }
            },

            getAll: () => {
                CategoryManager.init();
                try {
                    return JSON.parse(localStorage.getItem(CATEGORY_STORAGE_KEY)) || INITIAL_CATEGORIES;
                } catch (e) {
                    console.error("Error loading categories", e);
                    return INITIAL_CATEGORIES;
                }
            },

            add: (category) => {
                const categories = CategoryManager.getAll();
                if (!categories.includes(category)) {
                    categories.push(category);
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(categories));
                }
            },

            delete: (category) => {
                const categories = CategoryManager.getAll();
                const filtered = categories.filter(c => c !== category);
                localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(filtered));
            }
        };

        try {
            window.ProductManager = ProductManager;
            window.CategoryManager = CategoryManager;
            console.log("Data Managers initialized");
        } catch (e) {
            console.warn("Could not attach managers to window", e);
        }

        // Export initial products for legacy support if needed, though most uses are via ProductManager
        const PRODUCTS = ProductManager.getAll();
    </script>
    <script type="text/babel">
        const CART_STORAGE_KEY = 'luxemarket_cart';

        const CartManager = {
            getCart: () => {
                try {
                    return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
                } catch (e) {
                    return [];
                }
            },

            addItem: (product, options = {}) => {
                const cart = CartManager.getCart();
                const existingItemIndex = cart.findIndex(item =>
                    item.productId === product.id &&
                    item.options.color === options.color &&
                    item.options.size === options.size
                );

                if (existingItemIndex > -1) {
                    cart[existingItemIndex].quantity += (options.quantity || 1);
                } else {
                    cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.isDailyDeal && product.dealPrice ? product.dealPrice : product.price,
                        image: product.image, // Use main image or specific variant image if passed
                        options: {
                            color: options.color,
                            size: options.size,
                            variantImage: options.variantImage // Store the specific image for the selected color
                        },
                        quantity: options.quantity || 1,
                        addedAt: new Date().toISOString()
                    });
                }

                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            updateQuantity: (index, newQuantity) => {
                const cart = CartManager.getCart();
                if (newQuantity <= 0) {
                    cart.splice(index, 1);
                } else {
                    cart[index].quantity = newQuantity;
                }
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            removeItem: (index) => {
                const cart = CartManager.getCart();
                cart.splice(index, 1);
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            clearCart: () => {
                localStorage.removeItem(CART_STORAGE_KEY);
                window.dispatchEvent(new Event('cart-updated'));
            },

            getCount: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + (Number(item?.quantity) || 0), 0);
            },

            getSubtotal: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + ((Number(item?.price) || 0) * (Number(item?.quantity) || 0)), 0);
            }
        };

        window.CartManager = CartManager;
    </script>
    <script type="text/babel">
        const ToastContext = React.createContext();

        function ToastProvider({ children }) {
            const [toasts, setToasts] = React.useState([]);

            const addToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);

                // Auto remove after 3 seconds
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 3000);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none">
                        {toasts.map(toast => (
                            <div
                                key={toast.id}
                                className={`pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-lg shadow-lg flex items-center justify-between animate-[fadeIn_0.3s_ease-out] ${toast.type === 'success' ? 'bg-gray-900 text-white' :
                                    toast.type === 'error' ? 'bg-red-600 text-white' : 'bg-blue-600 text-white'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <div className={
                                        toast.type === 'success' ? 'icon-circle-check text-xl' :
                                            toast.type === 'error' ? 'icon-circle-alert text-xl' : 'icon-info text-xl'
                                    }></div>
                                    <span className="text-sm font-medium">{toast.message}</span>
                                </div>
                                <button onClick={() => removeToast(toast.id)} className="ml-4 opacity-80 hover:opacity-100">
                                    <div className="icon-x text-sm"></div>
                                </button>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        }

        // Custom hook to use toast
        const useToast = () => {
            const context = React.useContext(ToastContext);
            if (!context) {
                throw new Error('useToast must be used within a ToastProvider');
            }
            return context;
        };

        // Make globally available
        window.ToastProvider = ToastProvider;
        window.useToast = useToast;
        window.ToastContext = ToastContext;
    </script>
    <script>
        console.log("[Non-Babel Alpha] Script block reached");
        window.addEventListener('click', (e) => console.log("[Non-Babel Click] Hitting:", e.target), true);
    </script>
    <script type="text/babel">
        // Global click capture outside of React to test baseline execution
        window.addEventListener('click', (e) => console.log("[Outer Global] Click hitting:", e.target), true);

        function Header({ cartCount, isMenuOpen, setIsMenuOpen, currentUser, onOpenAuth, onLogout }) {
            const [categoryOpen, setCategoryOpen] = React.useState(false);
            const dropdownRef = React.useRef(null);
            const searchRef = React.useRef(null);
            const { addToast } = useToast();

            // Clicking outside closes the dropdowns
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    // Category Dropdown
                    if (categoryOpen && dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setCategoryOpen(false);
                    }
                    // Search Suggestions
                    if (showSuggestions && searchRef.current && !searchRef.current.contains(event.target)) {
                        setShowSuggestions(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [categoryOpen, showSuggestions]);

            const categories = [
                "Electronics", "Fashion", "Furniture", "Accessories",
                "Sporting Goods", "Industrial", "Motors", "Deals"
            ];

            const getCategoryLink = (cat) => `index-portable.html?category=${encodeURIComponent(cat)}#featured-products`;

            const [searchTerm, setSearchTerm] = React.useState('');
            const [searchCategory, setSearchCategory] = React.useState('All Categories');
            const [searchSuggestions, setSearchSuggestions] = React.useState([]);
            const [showSuggestions, setShowSuggestions] = React.useState(false);

            // Sync search state from URL on mount
            React.useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const search = params.get('search');
                const category = params.get('category');
                if (search) setSearchTerm(search);
                if (category) setSearchCategory(category);
            }, []);

            // Update suggestions when searchTerm changes
            React.useEffect(() => {
                if (searchTerm && searchTerm.trim().length > 0) {
                    const allProducts = window.ProductManager ? window.ProductManager.getAll() : [];
                    const lowerTerm = searchTerm.toLowerCase();
                    const filtered = allProducts.filter(p => {
                        const matchesSearch = p.name.toLowerCase().includes(lowerTerm) ||
                            p.description.toLowerCase().includes(lowerTerm);
                        const matchesCategory = searchCategory === 'All Categories' || p.category === searchCategory;
                        return matchesSearch && matchesCategory;
                    }).slice(0, 5); // Limit to 5 suggestions
                    setSearchSuggestions(filtered);
                } else {
                    setSearchSuggestions([]);
                }
            }, [searchTerm, searchCategory]);

            const handleSearch = (term, cat) => {
                try {
                    // Handle arguments: if passed as event handler or undefined, use state
                    let actualTerm = searchTerm;
                    let actualCat = searchCategory;

                    if (typeof term === 'string') {
                        actualTerm = term;
                    }
                    if (typeof cat === 'string') {
                        actualCat = cat;
                    }
                    if (term === '') {
                        actualTerm = '';
                    }

                    let url = 'index-portable.html?';
                    const params = [];

                    if (actualTerm && typeof actualTerm === 'string' && actualTerm.trim()) {
                        params.push(`search=${encodeURIComponent(actualTerm.trim())}`);
                    }

                    if (actualCat && typeof actualCat === 'string' && actualCat !== 'All Categories') {
                        params.push(`category=${encodeURIComponent(actualCat)}`);
                    }

                    const finalUrl = url + params.join('&') + '#featured-products';
                    window.location.href = finalUrl;
                    setShowSuggestions(false);
                } catch (error) {
                    console.error('Search error:', error);
                    addToast('Search failed: ' + error.message, 'error');
                }
            };

            const handleComingSoon = (e, feature) => {
                e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            return (
                <header className="font-sans text-sm" data-name="header" data-file="components/Header.js">
                    {/* Top Utility Bar */}
                    <div className="bg-white border-b border-gray-200 py-1 hidden md:block">
                        <div className="container-custom flex justify-between items-center text-xs text-gray-600">
                            <div className="flex items-center gap-4">
                                {currentUser ? (
                                    <span className="flex items-center gap-1">
                                        Hi, <span className="font-bold text-gray-800">{currentUser.name}</span>!
                                        <button onClick={onLogout} className="text-blue-600 hover:underline ml-1">Sign out</button>
                                    </span>
                                ) : (
                                    <span className="flex items-center gap-1">
                                        Hi! <button onClick={() => onOpenAuth(false)} className="text-blue-600 hover:underline">Sign in</button> or <button onClick={() => onOpenAuth(true)} className="text-blue-600 hover:underline">register</button>
                                    </span>
                                )}
                                <a href="index-portable.html?filter=deals#featured-products" className="hover:underline text-[var(--accent-color)] font-medium">Daily Deals</a>
                                <a href="#footer" className="hover:underline">Help & Contact</a>
                            </div>
                            <div className="flex items-center gap-6">
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Shipping selection')} className="hover:underline">Ship to</a>
                                <a href="admin-portable.html" className="hover:underline">Sell</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Watchlist')} className="hover:underline flex items-center gap-1">
                                    Watchlist <div className="icon-chevron-down text-[10px]"></div>
                                </a>
                                <div className="relative group cursor-pointer z-50">
                                    <span className="hover:underline flex items-center gap-1">
                                        My LuxeMarket <div className="icon-chevron-down text-[10px]"></div>
                                    </span>
                                    <div className="absolute right-0 top-full bg-white border border-gray-200 shadow-lg rounded-b-md p-2 hidden group-hover:block w-32">
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Account Summary')} className="block px-2 py-1 hover:bg-gray-100">Summary</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Recently Viewed')} className="block px-2 py-1 hover:bg-gray-100">Recently Viewed</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Bids/Offers')} className="block px-2 py-1 hover:bg-gray-100">Bids/Offers</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Purchase History')} className="block px-2 py-1 hover:bg-gray-100">Purchase History</a>
                                    </div>
                                </div>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Notifications')} className="hover:text-gray-900 relative" title="Notifications">
                                    <div className="icon-bell text-lg"></div>
                                </a>
                                <a href="checkout-portable.html" className="hover:text-gray-900 relative" title="Cart">
                                    <div className="icon-shopping-cart text-lg"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Main Header */}
                    <div className="bg-white py-3 border-b border-gray-200 sticky top-0 z-[1000] shadow-sm">
                        <div className="container-custom">
                            <div className="flex items-center gap-4">
                                {/* Mobile Menu Button */}
                                <div className="md:hidden relative z-50">
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            setIsMenuOpen(!isMenuOpen);
                                        }}
                                        className="text-gray-500 hover:text-gray-700 p-1"
                                    >
                                        <div className={isMenuOpen ? "icon-x text-2xl" : "icon-menu text-2xl"}></div>
                                    </button>
                                </div>

                                {/* Logo */}
                                <a href="index-portable.html" className="flex-shrink-0 flex items-center gap-1 group">
                                    <div className="icon-shopping-bag text-3xl text-[var(--primary-color)]"></div>
                                    <span className="text-2xl font-bold tracking-tighter text-gray-900">
                                        Luxe<span className="text-[var(--primary-color)]">Market</span>
                                    </span>
                                </a>

                                {/* Shop by Category (Desktop) */}
                                <div ref={dropdownRef} className="relative hidden md:block z-50">
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            setCategoryOpen(!categoryOpen);
                                        }}
                                        className={`text-gray-600 hover:text-gray-900 text-sm font-medium flex items-center gap-1 whitespace-nowrap px-2 py-2 rounded-md transition-colors ${categoryOpen ? 'bg-gray-100' : ''}`}
                                    >
                                        Shop by category <div className={`icon-chevron-down text-xs transition-transform ${categoryOpen ? 'rotate-180' : ''}`}></div>
                                    </button>
                                    {categoryOpen && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white border border-gray-200 shadow-xl rounded-lg p-4 z-50 grid grid-cols-1 gap-2 animate-[fadeIn_0.2s_ease-out]">
                                            {categories.map(cat => (
                                                <a
                                                    key={cat}
                                                    href={getCategoryLink(cat)}
                                                    onClick={() => setCategoryOpen(false)}
                                                    className="hover:text-[var(--primary-color)] hover:underline flex items-center gap-2 p-1 rounded hover:bg-gray-50"
                                                >
                                                    <div className="icon-chevron-right text-xs text-gray-400"></div>
                                                    {cat}
                                                </a>
                                            ))}
                                            <div className="border-t border-gray-100 mt-2 pt-2">
                                                <a href="index-portable.html#featured-products" className="font-bold hover:underline block p-1">See all categories</a>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Search Bar */}
                                <div ref={searchRef} className="flex-grow flex items-center max-w-4xl mx-auto relative">
                                    <div className="flex-grow flex border-2 border-gray-300 rounded-full hover:border-gray-400 focus-within:border-[var(--primary-color)] transition-colors h-10 md:h-11 relative bg-gray-100">
                                        <div className="pl-3 flex items-center text-gray-400">
                                            <div className="icon-search text-gray-500"></div>
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Search for anything"
                                            className="flex-grow px-3 bg-transparent border-none focus:outline-none text-gray-900 placeholder-gray-500 w-full"
                                            value={searchTerm}
                                            onChange={(e) => {
                                                setSearchTerm(e.target.value);
                                                setShowSuggestions(true);
                                            }}
                                            onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                                            onFocus={() => setShowSuggestions(true)}
                                        />
                                        {/* Category Select inside Search (Desktop) */}
                                        <div className="hidden md:flex items-center border-l border-gray-300 px-3">
                                            <select
                                                value={searchCategory}
                                                onChange={(e) => {
                                                    const newCat = e.target.value;
                                                    setSearchCategory(newCat);
                                                    // Trigger search immediately
                                                    handleSearch(searchTerm, newCat);
                                                }}
                                                className="bg-transparent text-gray-600 text-sm focus:outline-none cursor-pointer max-w-[120px] truncate"
                                            >
                                                <option>All Categories</option>
                                                {categories.map(cat => <option key={cat}>{cat}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => handleSearch()}
                                        className="btn btn-primary rounded-full px-6 ml-2 h-10 md:h-11 text-base font-semibold min-w-[100px] hidden md:block hover:shadow-md transition-shadow"
                                    >
                                        Search
                                    </button>

                                    {/* Search Suggestions Dropdown */}
                                    {showSuggestions && searchTerm.length > 0 && (
                                        <div className="absolute top-full left-0 right-0 mt-3 bg-white border border-gray-200 shadow-2xl rounded-2xl overflow-hidden max-h-[70vh] overflow-y-auto z-[2000] animate-[fadeIn_0.2s_ease-out]">
                                            <div className="p-4 border-b border-gray-50 bg-gray-50/50 flex justify-between items-center">
                                                <span className="text-xs font-bold text-gray-500 uppercase tracking-wider">Suggested Products</span>
                                                <span className="text-xs text-gray-400">{searchSuggestions.length} results</span>
                                            </div>
                                            {searchSuggestions.length > 0 ? (
                                                <div className="divide-y divide-gray-50">
                                                    {searchSuggestions.map(product => (
                                                        <a
                                                            key={product.id}
                                                            href={`product-portable.html?id=${product.id}`}
                                                            onClick={(e) => {
                                                                setShowSuggestions(false);
                                                            }}
                                                            className="flex items-center gap-4 p-4 hover:bg-blue-50/50 transition-all group"
                                                        >
                                                            <div className="w-14 h-14 rounded-xl overflow-hidden border border-gray-100 bg-gray-50 flex-shrink-0 group-hover:scale-105 transition-transform">
                                                                <img src={product.image} alt={product.name} className="w-full h-full object-cover" />
                                                            </div>
                                                            <div className="flex-grow min-w-0">
                                                                <div className="text-sm font-bold text-gray-900 truncate mb-0.5">{product.name}</div>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-xs px-2 py-0.5 bg-gray-100 rounded text-gray-500">{product.category}</span>
                                                                    <div className="flex text-yellow-400 text-[10px]">
                                                                        <div className="icon-star fill-current"></div>
                                                                        <span className="text-gray-400 ml-1 font-medium">{product.rating}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-base font-black text-[var(--primary-color)]">
                                                                ${product.price.toFixed(2)}
                                                            </div>
                                                        </a>
                                                    ))}
                                                    <button
                                                        onClick={() => handleSearch()}
                                                        className="w-full text-center py-4 text-sm text-[var(--primary-color)] font-bold hover:bg-blue-50 transition-colors bg-white border-t border-gray-100 flex items-center justify-center gap-2"
                                                    >
                                                        <span>View all results for "{searchTerm}"</span>
                                                        <div className="icon-arrow-right text-sm"></div>
                                                    </button>
                                                </div>
                                            ) : (
                                                <div className="p-12 text-center">
                                                    <div className="icon-search text-gray-200 text-5xl mb-4 mx-auto"></div>
                                                    <p className="text-gray-500 font-medium">No products found for "{searchTerm}"</p>
                                                    <p className="text-xs text-gray-400 mt-1">Try different keywords or categories</p>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                <a href="#" onClick={(e) => handleComingSoon(e, 'Advanced Search')} className="text-xs text-gray-500 hover:text-gray-700 whitespace-nowrap hidden lg:block">Advanced</a>

                                {/* Mobile Cart Icon */}
                                <a href="checkout-portable.html" className="md:hidden relative text-gray-600">
                                    <div className="icon-shopping-cart text-2xl"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Nav Bar */}
                    <div className="border-b border-gray-200 bg-white hidden md:block">
                        <div className="container-custom">
                            <nav className="flex items-center justify-center gap-6 py-2 text-[13px] text-gray-600">
                                <a href="index-portable.html" className="hover:text-[var(--primary-color)] font-medium border-b-2 border-transparent hover:border-[var(--primary-color)] pb-1 transition-colors">Home</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Saved Items')} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors flex items-center gap-1">
                                    <div className="icon-heart text-xs"></div> Saved
                                </a>
                                {categories.slice(0, 6).map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors">{cat}</a>
                                ))}
                                <a href="admin-portable.html" className="text-[var(--primary-color)] hover:underline flex items-center gap-1 ml-4 border-l pl-4 border-gray-300">
                                    <div className="icon-shield-check text-xs"></div> Admin Panel
                                </a>
                            </nav>
                        </div>
                    </div>

                    {/* Mobile Menu Overlay */}
                    {isMenuOpen && (
                        <div className="md:hidden bg-white border-b border-gray-200 shadow-xl absolute top-full left-0 right-0 z-50 max-h-[80vh] overflow-y-auto">
                            <div className="p-4 flex flex-col space-y-4">
                                <div className="font-bold text-lg mb-2 flex justify-between items-center">
                                    Categories
                                    <button onClick={() => setIsMenuOpen(false)} className="text-gray-400"><div className="icon-x text-xl"></div></button>
                                </div>
                                {categories.map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="text-gray-700 py-1 border-b border-gray-50 pl-2">{cat}</a>
                                ))}
                                <div className="font-bold text-lg mt-4 mb-2">My Account</div>

                                {currentUser ? (
                                    <>
                                        <div className="text-gray-700 py-1 pl-2">Hi, {currentUser.name}</div>
                                        <button onClick={onLogout} className="text-left text-gray-700 py-1 pl-2">Sign Out</button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(false); }} className="text-left text-gray-700 py-1 pl-2">Sign In</button>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(true); }} className="text-left text-gray-700 py-1 pl-2">Register</button>
                                    </>
                                )}

                                <a href="admin-portable.html" className="text-[var(--primary-color)] font-medium py-1 mt-2 pl-2">Admin Dashboard</a>
                            </div>
                        </div>
                    )}
                </header>
            );
        }
    </script>
    <script type="text/babel">
        function Footer() {
            const currentYear = new Date().getFullYear();
            const { addToast } = useToast();

            const handleComingSoon = (e, feature) => {
                if (e) e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            const linkGroups = [
                {
                    title: "Buy",
                    links: ["Registration", "Money Back Guarantee", "Bidding & buying help", "Stores", "Charity Shop", "Seasonal Sales"]
                },
                {
                    title: "Sell",
                    links: ["Start selling", "Learn to sell", "Affiliates", "Seller Information Center"]
                },
                {
                    title: "Stay Connected",
                    links: ["LuxeMarket Blog", "Facebook", "Twitter", "Instagram", "Pinterest"]
                },
                {
                    title: "About LuxeMarket",
                    links: ["Company Info", "News", "Investors", "Careers", "Government Relations", "Advertise with us", "Policies"]
                },
                {
                    title: "Help & Contact",
                    links: ["Seller Information Center", "Contact Us", "Resolution Center", "Returns", "Shipping"]
                }
            ];

            return (
                <footer className="bg-white border-t border-gray-200 pt-12 pb-6 text-[13px]" data-name="footer" data-file="components/Footer.js">
                    <div className="container-custom">
                        {/* Main Links Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8 mb-12">
                            {linkGroups.map((group, idx) => (
                                <div key={idx}>
                                    <h3 className="font-bold text-gray-700 mb-4">{group.title}</h3>
                                    <ul className="space-y-2">
                                        {group.links.map(link => (
                                            <li key={link}>
                                                <a href="#" onClick={(e) => handleComingSoon(e, link)} className="text-gray-600 hover:text-[var(--primary-color)] hover:underline transition-colors block">
                                                    {link}
                                                </a>
                                            </li>
                                        ))}
                                    </ul>
                                    {group.title === "Stay Connected" && (
                                        <div className="flex gap-3 mt-4">
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Facebook')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-blue-600 hover:text-white transition-colors">
                                                <div className="icon-facebook text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Twitter')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-sky-400 hover:text-white transition-colors">
                                                <div className="icon-twitter text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Instagram')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-pink-600 hover:text-white transition-colors">
                                                <div className="icon-instagram text-sm"></div>
                                            </a>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* Bottom Section */}
                        <div className="border-t border-gray-200 pt-8">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-500">
                                <div className="flex flex-wrap justify-center md:justify-start gap-4 mb-2 md:mb-0">
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Accessibility')} className="hover:underline">Accessibility</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'User Agreement')} className="hover:underline">User Agreement</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Privacy')} className="hover:underline">Privacy</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Payments Terms of Use')} className="hover:underline">Payments Terms of Use</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Cookies')} className="hover:underline">Cookies</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Individual Privacy Rights')} className="hover:underline">Do not sell my personal info</a>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span>Copyright  1995-{currentYear} LuxeMarket Inc. All Rights Reserved.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
            );
        }
    </script>
    <script type="text/babel">
        function ProductCard({ product, addToCart }) {
            const { addToast } = useToast();
            const isDeal = product.isDailyDeal;
            const finalPrice = isDeal && product.dealPrice ? product.dealPrice : product.price;

            return (
                <div className="card flex flex-col h-full group overflow-hidden relative" data-name="product-card" data-file="components/ProductCard.js">
                    <div className="relative pt-[100%] overflow-hidden bg-gray-100">
                        <a href={`product-portable.html?id=${product.id}`}>
                            <img
                                src={product.image}
                                alt={product.name}
                                className="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                            />
                        </a>

                        {/* Badges */}
                        <div className="absolute top-3 left-3 flex flex-col gap-2">
                            {isDeal && (
                                <span className="bg-[var(--accent-color)] text-white text-xs font-bold px-2 py-1 rounded shadow-sm">
                                    DAILY DEAL
                                </span>
                            )}
                            {product.price > 200 && !isDeal && (
                                <span className="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded shadow-sm">
                                    SALE
                                </span>
                            )}
                        </div>

                        {/* Overlay Actions */}
                        <div className="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-x-4 group-hover:translate-x-0">
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    addToast(`${product.name} added to wishlist!`, 'success');
                                }}
                                className="w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center text-gray-500 hover:text-red-500 transition-colors"
                                title="Add to Wishlist"
                            >
                                <div className="icon-heart text-sm"></div>
                            </button>
                            <a href={`product-portable.html?id=${product.id}`} className="w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center text-gray-500 hover:text-[var(--primary-color)] transition-colors" title="Quick View">
                                <div className="icon-eye text-sm"></div>
                            </a>
                        </div>
                    </div>

                    <div className="p-3 flex flex-col flex-grow">
                        <a
                            href={`index-portable.html?category=${encodeURIComponent(product.category)}#featured-products`}
                            className="text-[10px] text-gray-500 mb-1 hover:text-[var(--primary-color)] hover:underline"
                        >
                            {product.category}
                        </a>
                        <a href={`product-portable.html?id=${product.id}`} className="text-gray-900 font-semibold text-sm mb-1 line-clamp-2 hover:text-[var(--primary-color)] cursor-pointer leading-tight h-10">
                            {product.name}
                        </a>

                        <div className="flex items-center mb-2">
                            <div className="flex text-yellow-400 text-[10px]">
                                {[...Array(5)].map((_, i) => (
                                    <div key={i} className={`icon-star ${i < Math.floor(product.rating) ? 'fill-current' : 'text-gray-300'}`}></div>
                                ))}
                            </div>
                            <span className="text-[10px] text-gray-400 ml-1">({product.reviews})</span>
                        </div>

                        <div className="mt-auto flex items-center justify-between">
                            <div className="flex flex-col">
                                {isDeal && product.dealPrice ? (
                                    <>
                                        <span className="text-base font-bold text-red-600">${product.dealPrice.toFixed(2)}</span>
                                        <span className="text-[10px] text-gray-400 line-through">${product.price.toFixed(2)}</span>
                                    </>
                                ) : (
                                    <span className="text-base font-bold text-gray-900">${product.price.toFixed(2)}</span>
                                )}
                            </div>

                            <a
                                href={`product-portable.html?id=${product.id}`}
                                className="w-8 h-8 rounded-full bg-gray-100 text-gray-900 flex items-center justify-center hover:bg-[var(--primary-color)] hover:text-white transition-all duration-300"
                            >
                                <div className="icon-arrow-right text-base"></div>
                            </a>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function Hero() {
            const [currentSlide, setCurrentSlide] = React.useState(0);
            const { addToast } = useToast();

            const handleComingSoon = (e, feature) => {
                if (e) e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            const slides = [
                {
                    id: 1,
                    image: "https://images.unsplash.com/photo-1483985988355-763728e1935b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",
                    subtitle: "NEW SEASON ARRIVALS",
                    title: "Elevate Your Style With Premium Essentials",
                    description: "Discover our curated collection of high-quality products designed to enhance your lifestyle.",
                    ctaPrimary: "Shop Now",
                    ctaSecondary: "View Collections",
                    linkPrimary: "#featured-products",
                    linkSecondary: "#featured-products"
                },
                {
                    id: 2,
                    image: "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",
                    subtitle: "LATEST TECH",
                    title: "Next Gen Electronics For Your Home",
                    description: "Upgrade your space with smart home devices and premium audio equipment.",
                    ctaPrimary: "Shop Electronics",
                    ctaSecondary: "See All Deals",
                    linkPrimary: "?category=Electronics#featured-products",
                    linkSecondary: "#featured-products"
                },
                {
                    id: 3,
                    image: "https://images.unsplash.com/photo-1616486338812-3dadae4b4f9d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80",
                    subtitle: "COMFORT & DESIGN",
                    title: "Modern Furniture For Modern Living",
                    description: "Transform your workspace and living area with our ergonomic furniture collection.",
                    ctaPrimary: "Browse Furniture",
                    ctaSecondary: "Read Blog",
                    linkPrimary: "?category=Furniture#featured-products",
                    linkSecondary: "#"
                }
            ];

            React.useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentSlide((prev) => (prev + 1) % slides.length);
                }, 5000);
                return () => clearInterval(timer);
            }, [slides.length]);

            const nextSlide = () => {
                setCurrentSlide((prev) => (prev + 1) % slides.length);
            };

            const prevSlide = () => {
                setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length);
            };

            return (
                <div className="relative bg-gray-900 overflow-hidden h-[200px] md:h-[300px] group" data-name="hero-carousel" data-file="components/Hero.js">
                    {slides.map((slide, index) => (
                        <div
                            key={slide.id}
                            className={`absolute inset-0 transition-opacity duration-1000 ease-in-out ${index === currentSlide ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                        >
                            <div className="absolute inset-0">
                                <img
                                    className={`w-full h-full object-cover opacity-60 transition-opacity duration-1000 ${index === currentSlide ? 'animate-zoom' : ''}`}
                                    src={slide.image}
                                    alt={slide.title}
                                />
                                <div className="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/40 to-transparent"></div>
                            </div>

                            <div className="relative container-custom h-full flex items-center">
                                <div className="max-w-2xl animate-[fadeIn_0.8s_ease-out]">
                                    <span className="inline-block py-1 px-3 rounded bg-[var(--primary-color)] bg-opacity-20 text-[var(--accent-color)] text-sm font-semibold tracking-wider mb-4 border border-[var(--primary-color)] border-opacity-30">
                                        {slide.subtitle}
                                    </span>
                                    <h1 className="text-4xl md:text-5xl lg:text-7xl font-bold text-white mb-6 leading-[1.1] tracking-tight drop-shadow-lg">
                                        {slide.title}
                                    </h1>
                                    <p className="text-xl text-gray-200 mb-8 leading-relaxed max-w-xl drop-shadow-md">
                                        {slide.description}
                                    </p>
                                    <div className="flex flex-col sm:flex-row gap-4">
                                        <a href={slide.linkPrimary} className="btn bg-white text-gray-900 hover:bg-gray-100 text-lg px-10 py-4 rounded-full font-bold shadow-xl transition-all hover:scale-105 active:scale-95">
                                            {slide.ctaPrimary}
                                        </a>
                                        {slide.linkSecondary === "#" ? (
                                            <button onClick={(e) => handleComingSoon(e, slide.ctaSecondary)} className="btn bg-white/10 text-white hover:bg-white/20 border-2 border-white/30 text-lg px-10 py-4 rounded-full backdrop-blur-md font-semibold transition-all hover:border-white/60">
                                                {slide.ctaSecondary}
                                            </button>
                                        ) : (
                                            <a href={slide.linkSecondary} className="btn bg-white/10 text-white hover:bg-white/20 border-2 border-white/30 text-lg px-10 py-4 rounded-full backdrop-blur-md font-semibold transition-all hover:border-white/60">
                                                {slide.ctaSecondary}
                                            </a>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}

                    {/* Navigation Buttons */}
                    <button
                        onClick={prevSlide}
                        className="absolute left-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        <div className="icon-chevron-left text-2xl"></div>
                    </button>
                    <button
                        onClick={nextSlide}
                        className="absolute right-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
                    >
                        <div className="icon-chevron-right text-2xl"></div>
                    </button>

                    {/* Indicators */}
                    <div className="absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-2">
                        {slides.map((_, index) => (
                            <button
                                key={index}
                                onClick={() => setCurrentSlide(index)}
                                className={`w-3 h-3 rounded-full transition-all duration-300 ${index === currentSlide ? 'bg-[var(--primary-color)] w-8' : 'bg-white/50 hover:bg-white/80'}`}
                            ></button>
                        ))}
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function FeaturedProducts({ products, addToCart }) {
            return (
                <div className="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3" data-name="featured-products" data-file="components/FeaturedProducts.js">
                    {products.map(product => (
                        <ProductCard key={product.id} product={product} addToCart={addToCart} />
                    ))}
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function Newsletter() {
            const { addToast } = useToast();

            const handleSubmit = (e) => {
                e.preventDefault();
                addToast('Thanks for subscribing! Keep an eye on your inbox.', 'success');
                e.target.reset();
            };

            return (
                <div className="bg-[var(--primary-color)] py-16" data-name="newsletter" data-file="components/Newsletter.js">
                    <div className="container-custom">
                        <div className="flex flex-col md:flex-row items-center justify-between gap-8">
                            <div className="text-white max-w-lg">
                                <h2 className="text-3xl font-bold mb-4">Subscribe to our newsletter</h2>
                                <p className="text-blue-100 text-lg">
                                    Get the latest updates on new products and upcoming sales directly in your inbox.
                                </p>
                            </div>

                            <div className="w-full max-w-md">
                                <form className="flex flex-col sm:flex-row gap-3" onSubmit={handleSubmit}>
                                    <input
                                        type="email"
                                        placeholder="Enter your email address"
                                        className="flex-grow px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300"
                                        required
                                    />
                                    <button type="submit" className="bg-gray-900 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-800 transition-colors shadow-lg">
                                        Subscribe
                                    </button>
                                </form>
                                <div className="text-blue-200 text-sm mt-3 flex items-center gap-1">
                                    <div className="icon-lock text-xs"></div>
                                    Your email is safe with us. No spam.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function AuthModal({ isOpen, onClose, onLogin }) {
            const [isRegistering, setIsRegistering] = React.useState(false);
            const [formData, setFormData] = React.useState({
                name: '',
                email: '',
                password: ''
            });

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                // Mock authentication
                const user = {
                    name: isRegistering ? formData.name : (formData.email.split('@')[0] || 'User'),
                    email: formData.email
                };

                // Save mock session
                sessionStorage.setItem('luxemarket_user', JSON.stringify(user));

                onLogin(user);
                onClose();
                setFormData({ name: '', email: '', password: '' });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] animate-[fadeIn_0.2s_ease-out]">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden relative" onClick={e => e.stopPropagation()}>
                        <button
                            onClick={onClose}
                            className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
                        >
                            <div className="icon-x text-xl"></div>
                        </button>

                        <div className="p-8">
                            <div className="text-center mb-6">
                                <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-[var(--primary-color)] mb-4">
                                    <div className="icon-user text-2xl"></div>
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900">
                                    {isRegistering ? 'Create Account' : 'Welcome Back'}
                                </h2>
                                <p className="text-gray-500 text-sm mt-1">
                                    {isRegistering ? 'Join us for exclusive deals' : 'Sign in to continue shopping'}
                                </p>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                {isRegistering && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={formData.name}
                                            onChange={e => setFormData({ ...formData, name: e.target.value })}
                                        />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                    <input
                                        type="email"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.email}
                                        onChange={e => setFormData({ ...formData, email: e.target.value })}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input
                                        type="password"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.password}
                                        onChange={e => setFormData({ ...formData, password: e.target.value })}
                                    />
                                </div>

                                <button type="submit" className="w-full btn btn-primary py-2.5 mt-2">
                                    {isRegistering ? 'Register' : 'Sign In'}
                                </button>
                            </form>

                            <div className="mt-6 text-center text-sm">
                                <span className="text-gray-500">
                                    {isRegistering ? 'Already have an account?' : 'New to LuxeMarket?'}
                                </span>
                                <button
                                    onClick={() => setIsRegistering(!isRegistering)}
                                    className="text-[var(--primary-color)] font-medium hover:underline ml-1"
                                >
                                    {isRegistering ? 'Sign In' : 'Create account'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        // Important: DO NOT remove this `ErrorBoundary` component.
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ErrorBoundary caught an error:', error, errorInfo.componentStack);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50">
                            <div className="text-center p-8">
                                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4">
                                    <div className="icon-triangle-alert text-2xl text-red-600"></div>
                                </div>
                                <h1 className="text-2xl font-bold text-gray-900 mb-4">Something went wrong</h1>
                                <p className="text-gray-600 mb-6">We encountered an unexpected error. Please try reloading.</p>
                                <button
                                    onClick={() => window.location.reload()}
                                    className="btn btn-primary"
                                >
                                    Reload Page
                                </button>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        function App() {
            const [cartCount, setCartCount] = React.useState(0);
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [products, setProducts] = React.useState([]);
            const [filteredProducts, setFilteredProducts] = React.useState([]);
            const [activeCategory, setActiveCategory] = React.useState(null);

            // Auth State
            const [currentUser, setCurrentUser] = React.useState(null);
            const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);

            const { addToast } = useToast();

            React.useEffect(() => {
                // Load User
                const savedUser = sessionStorage.getItem('luxemarket_user');
                if (savedUser) {
                    setCurrentUser(JSON.parse(savedUser));
                }

                // Fetch products on mount
                const allProducts = window.ProductManager.getAll();
                setProducts(allProducts);

                // Initial Filter based on URL
                handleFilter(allProducts);

                // Initial Cart Count
                setCartCount(window.CartManager.getCount());

                // Listen for hash/URL changes
                const handleLocationChange = () => handleFilter(allProducts);
                window.addEventListener('popstate', handleLocationChange);

                // Listen for cart changes
                const handleCartUpdate = () => {
                    setCartCount(window.CartManager.getCount());
                };
                window.addEventListener('cart-updated', handleCartUpdate);

                // Listen for storage changes (Cross-tab sync for products)
                const handleStorageChange = (e) => {
                    if (e.key === 'luxemarket_products' || e.key === 'luxemarket_categories') {
                        setProducts(window.ProductManager.getAll());
                    }
                };
                window.addEventListener('storage', handleStorageChange);

                return () => {
                    window.removeEventListener('popstate', handleLocationChange);
                    window.removeEventListener('cart-updated', handleCartUpdate);
                    window.removeEventListener('storage', handleStorageChange);
                };
            }, []);

            const handleFilter = (allProducts) => {
                const params = new URLSearchParams(window.location.search);
                const category = params.get('category');
                const filter = params.get('filter');
                const search = params.get('search');

                let current = allProducts;
                let label = null;

                // 1. Filter by Daily Deals
                if (filter === 'deals') {
                    current = current.filter(p => p.isDailyDeal);
                    label = 'Daily Deals';
                }

                // 2. Filter by Category
                if (category && category !== 'All Categories') {
                    current = current.filter(p => p.category === category);
                    label = category;
                }

                // 3. Filter by Search Term
                if (search) {
                    const lower = search.toLowerCase();
                    current = current.filter(p =>
                        p.name.toLowerCase().includes(lower) ||
                        p.description.toLowerCase().includes(lower)
                    );
                    label = `Search: "${search}"` + (label ? ` in ${label}` : '');
                }

                setActiveCategory(label);
                setFilteredProducts(current);

                // Scrolling is handled by the useEffect on activeCategory
            };

            // Scroll to products when category changes
            React.useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const isFiltered = params.get('search') || params.get('category') || params.get('filter');

                if (activeCategory && isFiltered) {
                    const section = document.getElementById('featured-products');
                    if (section) {
                        setTimeout(() => {
                            const yOffset = -200; // Increased offset for better visibility
                            const y = section.getBoundingClientRect().top + window.pageYOffset + yOffset;
                            window.scrollTo({ top: y, behavior: 'smooth' });
                        }, 100);
                    }
                }
            }, [activeCategory]);

            const addToCart = (product) => {
                if (!currentUser) {
                    setIsAuthModalOpen(true);
                    return;
                }

                // Default options for quick add from card
                // Use first color/size if available
                const defaultOptions = {
                    color: product.colors && product.colors.length > 0 ? (typeof product.colors[0] === 'string' ? product.colors[0] : product.colors[0].name) : null,
                    size: product.sizes && product.sizes.length > 0 ? product.sizes[0] : null,
                    quantity: 1
                };

                window.CartManager.addItem(product, defaultOptions);
                addToast(`Added ${product.name} to cart`, 'success');
            };

            const handleLogin = (user) => {
                setCurrentUser(user);
                addToast(`Welcome back, ${user.name}!`, 'success');
            };

            const handleLogout = () => {
                sessionStorage.removeItem('luxemarket_user');
                setCurrentUser(null);
                addToast('Successfully logged out', 'info');
                setTimeout(() => window.location.reload(), 1000);
            };

            try {
                return (
                    <div className="min-h-screen flex flex-col" data-name="app-container" data-file="app.js">
                        <Header
                            cartCount={cartCount}
                            isMenuOpen={isMenuOpen}
                            setIsMenuOpen={setIsMenuOpen}
                            currentUser={currentUser}
                            onOpenAuth={() => setIsAuthModalOpen(true)}
                            onLogout={handleLogout}
                        />

                        <main className="flex-grow">
                            <Hero />

                            <div id="featured-products" className="pt-2 pb-12 bg-gray-50 scroll-mt-32">
                                <div className="container-custom">
                                    <div className="flex items-center justify-between mb-8">
                                        <div className="flex flex-col">
                                            <h2 className="text-2xl font-bold text-gray-900">
                                                {activeCategory ? `${activeCategory}` : 'Featured Products'}
                                            </h2>
                                            {activeCategory && (
                                                <a href="index-portable.html" className="text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1 mt-1 group">
                                                    <div className="icon-arrow-left text-xs transition-transform group-hover:-translate-x-1"></div>
                                                    Go back to all products
                                                </a>
                                            )}
                                        </div>

                                        {!activeCategory && (
                                            <button
                                                onClick={() => {
                                                    window.scrollTo({ top: document.getElementById('featured-products').offsetTop - 150, behavior: 'smooth' });
                                                    addToast('Viewing all available products', 'info');
                                                }}
                                                className="text-[var(--primary-color)] font-medium hover:text-[var(--primary-hover)] flex items-center gap-1"
                                            >
                                                View All <div className="icon-arrow-right text-sm"></div>
                                            </button>
                                        )}
                                    </div>

                                    {filteredProducts.length > 0 ? (
                                        <FeaturedProducts products={filteredProducts} addToCart={addToCart} />
                                    ) : (
                                        <div className="text-center py-12 bg-white rounded-lg border border-gray-200">
                                            <div className="icon-search text-4xl text-gray-300 mx-auto mb-3"></div>
                                            <p className="text-gray-500">No products found here.</p>
                                            <a href="index-portable.html" className="text-[var(--primary-color)] hover:underline mt-2 inline-block">View all products</a>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <Newsletter />
                        </main>

                        <Footer />

                        <AuthModal
                            isOpen={isAuthModalOpen}
                            onClose={() => setIsAuthModalOpen(false)}
                            onLogin={handleLogin}
                        />
                    </div>
                );
            } catch (error) {
                console.error('App component error:', error);
                return null;
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <ToastProvider>
                    <App />
                </ToastProvider>
            </ErrorBoundary>
        );
    </script>
</body>

</html>