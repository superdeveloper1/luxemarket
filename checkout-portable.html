<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - LuxeMarket</title>

    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style type="text/tailwindcss">
        @layer theme {
        :root {
            --primary-color: #2563EB;
            --primary-hover: #1D4ED8;
            --secondary-color: #F3F4F6;
            --text-main: #111827;
            --text-muted: #6B7280;
            --bg-body: #F3F4F6;
            --accent-color: #F59E0B;
        }
    }

    @layer base {
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
        }
    }

    @layer components {
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- App Scripts -->
    <script type="text/babel">
        const INITIAL_PRODUCTS = [
            {
                id: 1,
                name: "Premium Wireless Headphones",
                price: 299.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.8,
                reviews: 124,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" },
                    { name: "Navy", hex: "#000080" }
                ],
                sizes: ["One Size"],
                description: "Immerse yourself in pure sound with our active noise-cancelling technology. Features 30-hour battery life and ultra-comfortable ear cushions.",
                images: [
                    "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": [
                        "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1484704849700-f032a568e944?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1524678606370-a47ad25cb82a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Silver": [
                        "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        "https://images.unsplash.com/photo-1577174881658-0f30ed549adc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ],
                    "Navy": [
                        "https://images.unsplash.com/photo-1613040809024-b4ef7ba99bc3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                    ]
                }
            },
            {
                id: 2,
                name: "Minimalist Watch Series 5",
                price: 159.50,
                category: "Accessories",
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.6,
                reviews: 89,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Gold", hex: "#FFD700" },
                    { name: "Rose Gold", hex: "#B76E79" }
                ],
                sizes: ["40mm", "44mm"],
                description: "A timeless piece for the modern individual. Features a genuine leather strap, water resistance up to 50m, and a scratch-resistant sapphire crystal glass.",
                images: [
                    "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Gold": "https://images.unsplash.com/photo-1524805444758-089113d48a6d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Rose Gold": "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 3,
                name: "Ergonomic Office Chair",
                price: 499.00,
                category: "Furniture",
                image: "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 215,
                colors: [
                    { name: "Black", hex: "#111827" },
                    { name: "Grey", hex: "#6B7280" },
                    { name: "Blue", hex: "#2563EB" }
                ],
                sizes: ["Standard", "Large"],
                description: "Work in comfort with adjustable lumbar support, 4D armrests, and breathable mesh back. Designed to support your posture during long working hours.",
                images: [
                    "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Grey": "https://images.unsplash.com/photo-1505843490538-5133c6c7d0e1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Blue": "https://images.unsplash.com/photo-1580480055273-228ff5388ef8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 4,
                name: "Smart Home Speaker",
                price: 89.99,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.5,
                reviews: 67,
                colors: [
                    { name: "White", hex: "#F3F4F6" },
                    { name: "Black", hex: "#111827" },
                    { name: "Charcoal", hex: "#374151" }
                ],
                sizes: ["Mini", "Standard"],
                description: "Fill your room with rich, 360-degree sound. Compatible with all major voice assistants and features multi-room audio synchronization.",
                images: [
                    "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "White": "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Charcoal": "https://images.unsplash.com/photo-1543512214-318c77a07298?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 5,
                name: "Classic Leather Backpack",
                price: 129.95,
                category: "Fashion",
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.7,
                reviews: 156,
                colors: [
                    { name: "Brown", hex: "#8B4513" },
                    { name: "Black", hex: "#000000" },
                    { name: "Tan", hex: "#D2B48C" }
                ],
                sizes: ["15L", "20L"],
                description: "Handcrafted from full-grain leather that ages beautifully. Features a dedicated laptop compartment and multiple organizer pockets for your daily essentials.",
                images: [
                    "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Brown": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Black": "https://images.unsplash.com/photo-1581605405669-fcdf81165afa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Tan": "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            },
            {
                id: 6,
                name: "Digital Camera 4K",
                price: 849.00,
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                rating: 4.9,
                reviews: 342,
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Silver", hex: "#C0C0C0" }
                ],
                sizes: ["Body Only", "Kit Lens"],
                description: "Capture life's moments in stunning detail. Features a 24MP sensor, 4K video recording, and fast hybrid autofocus system.",
                images: [
                    "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                variantImages: {
                    "Black": "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "Silver": "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                }
            }
        ];

        const INITIAL_CATEGORIES = [
            "Electronics",
            "Fashion",
            "Furniture",
            "Accessories"
        ];

        const PRODUCT_STORAGE_KEY = 'luxemarket_products';
        const CATEGORY_STORAGE_KEY = 'luxemarket_categories';

        const ProductManager = {
            init: () => {
                if (!localStorage.getItem(PRODUCT_STORAGE_KEY)) {
                    localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(INITIAL_PRODUCTS));
                }
            },

            getAll: () => {
                ProductManager.init();
                try {
                    const raw = localStorage.getItem(PRODUCT_STORAGE_KEY);
                    let stored = JSON.parse(raw) || [];
                    let modified = false;

                    const migrated = stored.map(p => {
                        const initial = INITIAL_PRODUCTS.find(ip => ip.id === p.id);
                        if (initial) {
                            // Backfill variantImages if missing
                            if (!p.variantImages && initial.variantImages) {
                                p.variantImages = initial.variantImages;
                                modified = true;
                            }
                            // Backfill images array if missing or empty
                            if ((!p.images || p.images.length === 0) && initial.images) {
                                p.images = initial.images;
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize variantImages to be arrays
                        if (p.variantImages) {
                            let variantModified = false;
                            Object.keys(p.variantImages).forEach(color => {
                                if (typeof p.variantImages[color] === 'string') {
                                    p.variantImages[color] = [p.variantImages[color]];
                                    variantModified = true;
                                }
                            });
                            if (variantModified) {
                                modified = true;
                            }
                        }

                        // DATA MIGRATION: Normalize Colors
                        if (p.colors && p.colors.length > 0) {
                            let colorsModified = false;
                            const normalizedColors = p.colors.map(c => {
                                if (typeof c === 'string') {
                                    colorsModified = true;
                                    const lower = c.toLowerCase();
                                    let hex = '#374151'; // Default gray-700
                                    if (lower === 'black') hex = '#000000';
                                    if (lower === 'white') hex = '#FFFFFF';
                                    if (lower === 'silver') hex = '#C0C0C0';
                                    if (lower === 'gold') hex = '#FFD700';
                                    if (lower === 'navy') hex = '#000080';
                                    if (lower === 'red') hex = '#EF4444';
                                    if (lower === 'blue') hex = '#3B82F6';
                                    if (lower === 'rose gold') hex = '#B76E79';
                                    if (lower === 'grey' || lower === 'gray') hex = '#808080';
                                    if (lower === 'brown') hex = '#8B4513';
                                    if (lower === 'tan') hex = '#D2B48C';

                                    return { name: c, hex: hex };
                                }
                                return c;
                            });
                            if (colorsModified) {
                                p.colors = normalizedColors;
                                modified = true;
                            }
                        }

                        return p;
                    });

                    if (modified) {
                        console.log("Persisting migrated data to localStorage");
                        localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(migrated));
                    }

                    return migrated;
                } catch (e) {
                    console.error("Error loading products from localStorage", e);
                    return INITIAL_PRODUCTS;
                }
            },

            getById: (id) => {
                const products = ProductManager.getAll();
                return products.find(p => p.id === Number(id));
            },

            save: (product) => {
                console.log("ProductManager.save called with:", product);
                const products = ProductManager.getAll();
                if (product.id) {
                    // Update existing
                    const index = products.findIndex(p => p.id === Number(product.id));
                    if (index !== -1) {
                        products[index] = { ...products[index], ...product, id: Number(product.id) };
                        console.log("Updated product at index:", index);
                    } else {
                        console.warn("Product with ID not found for update, adding as new:", product.id);
                        const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                        products.push({ ...product, id: newId, rating: product.rating || 0, reviews: product.reviews || 0 });
                    }
                } else {
                    // Add new
                    const newId = Math.max(...products.map(p => Number(p.id) || 0), 0) + 1;
                    products.push({ ...product, id: newId, rating: 0, reviews: 0 });
                    console.log("Added new product with ID:", newId);
                }
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(products));
                console.log("Saved to localStorage. New count:", products.length);
            },

            delete: (id) => {
                const products = ProductManager.getAll();
                const filtered = products.filter(p => p.id !== id);
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(filtered));
            },

            reorder: (newProducts) => {
                localStorage.setItem(PRODUCT_STORAGE_KEY, JSON.stringify(newProducts));
            }
        };

        const CategoryManager = {
            init: () => {
                if (!localStorage.getItem(CATEGORY_STORAGE_KEY)) {
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(INITIAL_CATEGORIES));
                }
            },

            getAll: () => {
                CategoryManager.init();
                try {
                    return JSON.parse(localStorage.getItem(CATEGORY_STORAGE_KEY)) || INITIAL_CATEGORIES;
                } catch (e) {
                    console.error("Error loading categories", e);
                    return INITIAL_CATEGORIES;
                }
            },

            add: (category) => {
                const categories = CategoryManager.getAll();
                if (!categories.includes(category)) {
                    categories.push(category);
                    localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(categories));
                }
            },

            delete: (category) => {
                const categories = CategoryManager.getAll();
                const filtered = categories.filter(c => c !== category);
                localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(filtered));
            }
        };

        try {
            window.ProductManager = ProductManager;
            window.CategoryManager = CategoryManager;
            console.log("Data Managers initialized");
        } catch (e) {
            console.warn("Could not attach managers to window", e);
        }

        // Export initial products for legacy support if needed, though most uses are via ProductManager
        const PRODUCTS = ProductManager.getAll();
    </script>
    <script type="text/babel">
        const CART_STORAGE_KEY = 'luxemarket_cart';

        const CartManager = {
            getCart: () => {
                try {
                    return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
                } catch (e) {
                    return [];
                }
            },

            addItem: (product, options = {}) => {
                const cart = CartManager.getCart();
                const existingItemIndex = cart.findIndex(item =>
                    item.productId === product.id &&
                    item.options.color === options.color &&
                    item.options.size === options.size
                );

                if (existingItemIndex > -1) {
                    cart[existingItemIndex].quantity += (options.quantity || 1);
                } else {
                    cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.isDailyDeal && product.dealPrice ? product.dealPrice : product.price,
                        image: product.image, // Use main image or specific variant image if passed
                        options: {
                            color: options.color,
                            size: options.size,
                            variantImage: options.variantImage // Store the specific image for the selected color
                        },
                        quantity: options.quantity || 1,
                        addedAt: new Date().toISOString()
                    });
                }

                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            updateQuantity: (index, newQuantity) => {
                const cart = CartManager.getCart();
                if (newQuantity <= 0) {
                    cart.splice(index, 1);
                } else {
                    cart[index].quantity = newQuantity;
                }
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            removeItem: (index) => {
                const cart = CartManager.getCart();
                cart.splice(index, 1);
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                window.dispatchEvent(new Event('cart-updated'));
            },

            clearCart: () => {
                localStorage.removeItem(CART_STORAGE_KEY);
                window.dispatchEvent(new Event('cart-updated'));
            },

            getCount: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + (Number(item?.quantity) || 0), 0);
            },

            getSubtotal: () => {
                const cart = CartManager.getCart();
                return cart.reduce((total, item) => total + ((Number(item?.price) || 0) * (Number(item?.quantity) || 0)), 0);
            }
        };

        window.CartManager = CartManager;
    </script>
    <script type="text/babel">
        const ToastContext = React.createContext();

        function ToastProvider({ children }) {
            const [toasts, setToasts] = React.useState([]);

            const addToast = (message, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);

                // Auto remove after 3 seconds
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 3000);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none">
                        {toasts.map(toast => (
                            <div
                                key={toast.id}
                                className={`pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-lg shadow-lg flex items-center justify-between animate-[fadeIn_0.3s_ease-out] ${toast.type === 'success' ? 'bg-gray-900 text-white' :
                                    toast.type === 'error' ? 'bg-red-600 text-white' : 'bg-blue-600 text-white'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <div className={
                                        toast.type === 'success' ? 'icon-circle-check text-xl' :
                                            toast.type === 'error' ? 'icon-circle-alert text-xl' : 'icon-info text-xl'
                                    }></div>
                                    <span className="text-sm font-medium">{toast.message}</span>
                                </div>
                                <button onClick={() => removeToast(toast.id)} className="ml-4 opacity-80 hover:opacity-100">
                                    <div className="icon-x text-sm"></div>
                                </button>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        }

        // Custom hook to use toast
        const useToast = () => {
            const context = React.useContext(ToastContext);
            if (!context) {
                throw new Error('useToast must be used within a ToastProvider');
            }
            return context;
        };
    </script>
    <script type="text/babel">
        function Header({ cartCount, isMenuOpen, setIsMenuOpen, currentUser, onOpenAuth, onLogout }) {
            const [categoryOpen, setCategoryOpen] = React.useState(false);
            const { addToast } = useToast();

            // Clicking outside closes the dropdown
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (categoryOpen && !event.target.closest('.category-dropdown-container')) {
                        setCategoryOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [categoryOpen]);

            const categories = [
                "Electronics", "Fashion", "Furniture", "Accessories",
                "Sporting Goods", "Industrial", "Motors", "Deals"
            ];

            const getCategoryLink = (cat) => `index-portable.html?category=${encodeURIComponent(cat)}#featured-products`;

            const handleComingSoon = (e, feature) => {
                e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            return (
                <header className="font-sans text-sm" data-name="header" data-file="components/Header.js">
                    {/* Top Utility Bar */}
                    <div className="bg-white border-b border-gray-200 py-1 hidden md:block">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center text-xs text-gray-600">
                            <div className="flex items-center gap-4">
                                {currentUser ? (
                                    <span className="flex items-center gap-1">
                                        Hi, <span className="font-bold text-gray-800">{currentUser.name}</span>!
                                        <button onClick={onLogout} className="text-blue-600 hover:underline ml-1">Sign out</button>
                                    </span>
                                ) : (
                                    <span className="flex items-center gap-1">
                                        Hi! <button onClick={() => onOpenAuth(false)} className="text-blue-600 hover:underline">Sign in</button> or <button onClick={() => onOpenAuth(true)} className="text-blue-600 hover:underline">register</button>
                                    </span>
                                )}
                                <a href="index-portable.html?filter=deals#featured-products" className="hover:underline text-[var(--accent-color)] font-medium">Daily Deals</a>
                                <a href="#footer" className="hover:underline">Help & Contact</a>
                            </div>
                            <div className="flex items-center gap-6">
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Shipping selection')} className="hover:underline">Ship to</a>
                                <a href="admin-portable.html" className="hover:underline">Sell</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Watchlist')} className="hover:underline flex items-center gap-1">
                                    Watchlist <div className="icon-chevron-down text-[10px]"></div>
                                </a>
                                <div className="relative group cursor-pointer z-50">
                                    <span className="hover:underline flex items-center gap-1">
                                        My LuxeMarket <div className="icon-chevron-down text-[10px]"></div>
                                    </span>
                                    <div className="absolute right-0 top-full bg-white border border-gray-200 shadow-lg rounded-b-md p-2 hidden group-hover:block w-32">
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Account Summary')} className="block px-2 py-1 hover:bg-gray-100">Summary</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Recently Viewed')} className="block px-2 py-1 hover:bg-gray-100">Recently Viewed</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Bids/Offers')} className="block px-2 py-1 hover:bg-gray-100">Bids/Offers</a>
                                        <a href="#" onClick={(e) => handleComingSoon(e, 'Purchase History')} className="block px-2 py-1 hover:bg-gray-100">Purchase History</a>
                                    </div>
                                </div>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Notifications')} className="hover:text-gray-900 relative" title="Notifications">
                                    <div className="icon-bell text-lg"></div>
                                </a>
                                <a href="checkout-portable.html" className="hover:text-gray-900 relative" title="Cart">
                                    <div className="icon-shopping-cart text-lg"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Main Header */}
                    <div className="bg-white py-3 border-b border-gray-200 sticky top-0 z-40 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center gap-4">
                                {/* Mobile Menu Button */}
                                <div className="md:hidden">
                                    <button
                                        onClick={() => setIsMenuOpen(!isMenuOpen)}
                                        className="text-gray-500 hover:text-gray-700 p-1"
                                    >
                                        <div className={isMenuOpen ? "icon-x text-2xl" : "icon-menu text-2xl"}></div>
                                    </button>
                                </div>

                                {/* Logo */}
                                <a href="index-portable.html" className="flex-shrink-0 flex items-center gap-1 group">
                                    <div className="icon-shopping-bag text-3xl text-[var(--primary-color)]"></div>
                                    <span className="text-2xl font-bold tracking-tighter text-gray-900">
                                        Luxe<span className="text-[var(--primary-color)]">Market</span>
                                    </span>
                                </a>

                                {/* Shop by Category (Desktop) */}
                                <div className="relative hidden md:block category-dropdown-container">
                                    <button
                                        onClick={() => setCategoryOpen(!categoryOpen)}
                                        className={`text-gray-600 hover:text-gray-900 text-sm font-medium flex items-center gap-1 whitespace-nowrap px-2 py-2 rounded-md transition-colors ${categoryOpen ? 'bg-gray-100' : ''}`}
                                    >
                                        Shop by category <div className={`icon-chevron-down text-xs transition-transform ${categoryOpen ? 'rotate-180' : ''}`}></div>
                                    </button>
                                    {categoryOpen && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white border border-gray-200 shadow-xl rounded-lg p-4 z-50 grid grid-cols-1 gap-2 animate-[fadeIn_0.2s_ease-out]">
                                            {categories.map(cat => (
                                                <a
                                                    key={cat}
                                                    href={getCategoryLink(cat)}
                                                    onClick={() => setCategoryOpen(false)}
                                                    className="hover:text-[var(--primary-color)] hover:underline flex items-center gap-2 p-1 rounded hover:bg-gray-50"
                                                >
                                                    <div className="icon-chevron-right text-xs text-gray-400"></div>
                                                    {cat}
                                                </a>
                                            ))}
                                            <div className="border-t border-gray-100 mt-2 pt-2">
                                                <a href="index-portable.html#featured-products" className="font-bold hover:underline block p-1">See all categories</a>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Search Bar */}
                                <div className="flex-grow flex items-center max-w-4xl mx-auto">
                                    <div className="flex-grow flex border-2 border-gray-300 rounded-full hover:border-gray-400 focus-within:border-[var(--primary-color)] transition-colors h-10 md:h-11 relative bg-gray-100">
                                        <div className="pl-3 flex items-center text-gray-400">
                                            <div className="icon-search text-gray-500"></div>
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Search for anything"
                                            className="flex-grow px-3 bg-transparent border-none focus:outline-none text-gray-900 placeholder-gray-500 w-full"
                                        />
                                        {/* Category Select inside Search (Desktop) */}
                                        <div className="hidden md:flex items-center border-l border-gray-300 px-3">
                                            <select className="bg-transparent text-gray-600 text-sm focus:outline-none cursor-pointer max-w-[120px] truncate">
                                                <option>All Categories</option>
                                                {categories.map(cat => <option key={cat}>{cat}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <button className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)] rounded-full px-6 ml-2 h-10 md:h-11 text-base font-semibold min-w-[100px] hidden md:block hover:shadow-md transition-shadow">
                                        Search
                                    </button>
                                </div>

                                <a href="#" onClick={(e) => handleComingSoon(e, 'Advanced Search')} className="text-xs text-gray-500 hover:text-gray-700 whitespace-nowrap hidden lg:block">Advanced</a>

                                {/* Mobile Cart Icon */}
                                <a href="checkout-portable.html" className="md:hidden relative text-gray-600">
                                    <div className="icon-shopping-cart text-2xl"></div>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-1 -right-2 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white transform bg-red-600 rounded-full animate-bounce">
                                            {cartCount}
                                        </span>
                                    )}
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Nav Bar */}
                    <div className="border-b border-gray-200 bg-white hidden md:block">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav className="flex items-center justify-center gap-6 py-2 text-[13px] text-gray-600">
                                <a href="index-portable.html" className="hover:text-[var(--primary-color)] font-medium border-b-2 border-transparent hover:border-[var(--primary-color)] pb-1 transition-colors">Home</a>
                                <a href="#" onClick={(e) => handleComingSoon(e, 'Saved Items')} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors flex items-center gap-1">
                                    <div className="icon-heart text-xs"></div> Saved
                                </a>
                                {categories.slice(0, 6).map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="hover:text-[var(--primary-color)] hover:border-[var(--primary-color)] border-b-2 border-transparent pb-1 transition-colors">{cat}</a>
                                ))}
                                <a href="admin-portable.html" className="text-[var(--primary-color)] hover:underline flex items-center gap-1 ml-4 border-l pl-4 border-gray-300">
                                    <div className="icon-shield-check text-xs"></div> Admin Panel
                                </a>
                            </nav>
                        </div>
                    </div>

                    {/* Mobile Menu Overlay */}
                    {isMenuOpen && (
                        <div className="md:hidden bg-white border-b border-gray-200 shadow-xl absolute w-full z-50 max-h-[80vh] overflow-y-auto">
                            <div className="p-4 flex flex-col space-y-4">
                                <div className="font-bold text-lg mb-2 flex justify-between items-center">
                                    Categories
                                    <button onClick={() => setIsMenuOpen(false)} className="text-gray-400"><div className="icon-x text-xl"></div></button>
                                </div>
                                {categories.map(cat => (
                                    <a key={cat} href={getCategoryLink(cat)} className="text-gray-700 py-1 border-b border-gray-50 pl-2">{cat}</a>
                                ))}
                                <div className="font-bold text-lg mt-4 mb-2">My Account</div>

                                {currentUser ? (
                                    <>
                                        <div className="text-gray-700 py-1 pl-2">Hi, {currentUser.name}</div>
                                        <button onClick={onLogout} className="text-left text-gray-700 py-1 pl-2">Sign Out</button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(false); }} className="text-left text-gray-700 py-1 pl-2">Sign In</button>
                                        <button onClick={() => { setIsMenuOpen(false); onOpenAuth(true); }} className="text-left text-gray-700 py-1 pl-2">Register</button>
                                    </>
                                )}

                                <a href="admin-portable.html" className="text-[var(--primary-color)] font-medium py-1 mt-2 pl-2">Admin Dashboard</a>
                            </div>
                        </div>
                    )}
                </header>
            );
        }
    </script>
    <script type="text/babel">
        function Footer() {
            const currentYear = new Date().getFullYear();
            const { addToast } = useToast();

            const handleComingSoon = (e, feature) => {
                if (e) e.preventDefault();
                addToast(`${feature} feature coming soon!`, 'info');
            };

            const linkGroups = [
                {
                    title: "Buy",
                    links: ["Registration", "Money Back Guarantee", "Bidding & buying help", "Stores", "Charity Shop", "Seasonal Sales"]
                },
                {
                    title: "Sell",
                    links: ["Start selling", "Learn to sell", "Affiliates", "Seller Information Center"]
                },
                {
                    title: "Stay Connected",
                    links: ["LuxeMarket Blog", "Facebook", "Twitter", "Instagram", "Pinterest"]
                },
                {
                    title: "About LuxeMarket",
                    links: ["Company Info", "News", "Investors", "Careers", "Government Relations", "Advertise with us", "Policies"]
                },
                {
                    title: "Help & Contact",
                    links: ["Seller Information Center", "Contact Us", "Resolution Center", "Returns", "Shipping"]
                }
            ];

            return (
                <footer className="bg-white border-t border-gray-200 pt-12 pb-6 text-[13px]" data-name="footer" data-file="components/Footer.js">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        {/* Main Links Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8 mb-12">
                            {linkGroups.map((group, idx) => (
                                <div key={idx}>
                                    <h3 className="font-bold text-gray-700 mb-4">{group.title}</h3>
                                    <ul className="space-y-2">
                                        {group.links.map(link => (
                                            <li key={link}>
                                                <a href="#" onClick={(e) => handleComingSoon(e, link)} className="text-gray-600 hover:text-[var(--primary-color)] hover:underline transition-colors block">
                                                    {link}
                                                </a>
                                            </li>
                                        ))}
                                    </ul>
                                    {group.title === "Stay Connected" && (
                                        <div className="flex gap-3 mt-4">
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Facebook')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-blue-600 hover:text-white transition-colors">
                                                <div className="icon-facebook text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Twitter')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-sky-400 hover:text-white transition-colors">
                                                <div className="icon-twitter text-sm"></div>
                                            </a>
                                            <a href="#" onClick={(e) => handleComingSoon(e, 'Instagram')} className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-pink-600 hover:text-white transition-colors">
                                                <div className="icon-instagram text-sm"></div>
                                            </a>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* Bottom Section */}
                        <div className="border-t border-gray-200 pt-8">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-500">
                                <div className="flex flex-wrap justify-center md:justify-start gap-4 mb-2 md:mb-0">
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Accessibility')} className="hover:underline">Accessibility</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'User Agreement')} className="hover:underline">User Agreement</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Privacy')} className="hover:underline">Privacy</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Payments Terms of Use')} className="hover:underline">Payments Terms of Use</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Cookies')} className="hover:underline">Cookies</a>
                                    <span className="hidden md:inline">|</span>
                                    <a href="#" onClick={(e) => handleComingSoon(e, 'Individual Privacy Rights')} className="hover:underline">Do not sell my personal info</a>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span>Copyright Â© 1995-{currentYear} LuxeMarket Inc. All Rights Reserved.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
            );
        }
    </script>
    <script type="text/babel">
        function CheckoutFlow() {
            const [cart, setCart] = React.useState([]);
            const [step, setStep] = React.useState(1); // 1: Cart, 2: Shipping, 3: Payment, 4: Success
            const [loading, setLoading] = React.useState(false);
            const { addToast } = useToast();

            // Shipping State
            const [shippingInfo, setShippingInfo] = React.useState({
                fullName: '',
                address: '',
                city: '',
                zip: '',
                country: 'United States'
            });

            // Payment State
            const [paymentInfo, setPaymentInfo] = React.useState({
                cardNumber: '',
                expiry: '',
                cvc: ''
            });

            React.useEffect(() => {
                // Initial load
                setCart(window.CartManager.getCart());

                // Listen for updates
                const handleCartUpdate = () => setCart(window.CartManager.getCart());
                window.addEventListener('cart-updated', handleCartUpdate);
                return () => window.removeEventListener('cart-updated', handleCartUpdate);
            }, []);

            const updateQty = (index, delta) => {
                const item = cart[index];
                window.CartManager.updateQuantity(index, item.quantity + delta);
            };

            const removeItem = (index) => {
                window.CartManager.removeItem(index);
                addToast('Item removed from cart', 'info');
            };

            const subtotal = cart.reduce((sum, item) => sum + ((Number(item?.price) || 0) * (Number(item?.quantity) || 0)), 0);
            const shippingCost = subtotal > 100 ? 0 : 15.00;
            const tax = subtotal * 0.08;
            const total = subtotal + shippingCost + tax;

            const handleShippingSubmit = (e) => {
                e.preventDefault();
                setStep(3);
                window.scrollTo(0, 0);
            };

            const handlePaymentSubmit = (e) => {
                e.preventDefault();
                setLoading(true);

                // Simulate processing
                setTimeout(() => {
                    setLoading(false);
                    window.CartManager.clearCart();
                    setStep(4);
                    window.scrollTo(0, 0);
                    addToast('Order placed successfully!', 'success');
                }, 2000);
            };

            // Render Steps
            if (cart.length === 0 && step === 1) {
                return (
                    <div className="text-center py-20 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div className="icon-shopping-cart text-5xl text-gray-300 mx-auto mb-4"></div>
                        <h2 className="text-2xl font-bold text-gray-900 mb-2">Your cart is empty</h2>
                        <p className="text-gray-500 mb-6">Looks like you haven't added any items yet.</p>
                        <a href="index-portable.html" className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)]">Start Shopping</a>
                    </div>
                );
            }

            if (step === 4) {
                return (
                    <div className="text-center py-20 bg-white rounded-lg border border-green-100 shadow-sm animate-[fadeIn_0.5s_ease-out]">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                            <div className="icon-check text-4xl"></div>
                        </div>
                        <h2 className="text-3xl font-bold text-gray-900 mb-2">Thank you for your order!</h2>
                        <p className="text-gray-500 mb-6">Your order #{Math.floor(100000 + Math.random() * 900000)} has been placed successfully.</p>
                        <p className="text-sm text-gray-400 mb-8">We've sent a confirmation email to {shippingInfo.fullName ? 'your email' : 'you'}.</p>
                        <a href="index-portable.html" className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)]">Continue Shopping</a>
                    </div>
                );
            }

            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-8" data-name="checkout-flow" data-file="components/CheckoutFlow.js">
                    {/* Left Column: Forms/Steps */}
                    <div className="lg:col-span-8">
                        {/* Progress Indicators */}
                        <div className="flex items-center mb-8 text-sm font-medium">
                            <div className={`flex items-center ${step >= 1 ? 'text-[var(--primary-color)]' : 'text-gray-400'}`}>
                                <span className={`w-8 h-8 rounded-full flex items-center justify-center border-2 mr-2 ${step >= 1 ? 'border-[var(--primary-color)] bg-[var(--primary-color)] text-white' : 'border-gray-300'}`}>1</span>
                                Cart
                            </div>
                            <div className={`flex-grow h-px mx-4 ${step >= 2 ? 'bg-[var(--primary-color)]' : 'bg-gray-200'}`}></div>
                            <div className={`flex items-center ${step >= 2 ? 'text-[var(--primary-color)]' : 'text-gray-400'}`}>
                                <span className={`w-8 h-8 rounded-full flex items-center justify-center border-2 mr-2 ${step >= 2 ? 'border-[var(--primary-color)] bg-[var(--primary-color)] text-white' : 'border-gray-300'}`}>2</span>
                                Shipping
                            </div>
                            <div className={`flex-grow h-px mx-4 ${step >= 3 ? 'bg-[var(--primary-color)]' : 'bg-gray-200'}`}></div>
                            <div className={`flex items-center ${step >= 3 ? 'text-[var(--primary-color)]' : 'text-gray-400'}`}>
                                <span className={`w-8 h-8 rounded-full flex items-center justify-center border-2 mr-2 ${step >= 3 ? 'border-[var(--primary-color)] bg-[var(--primary-color)] text-white' : 'border-gray-300'}`}>3</span>
                                Payment
                            </div>
                        </div>

                        {/* Step 1: Cart Review */}
                        {step === 1 && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div className="p-6 border-b border-gray-100">
                                    <h2 className="text-lg font-bold text-gray-900">Shopping Cart ({cart.length} items)</h2>
                                </div>
                                <div className="divide-y divide-gray-100">
                                    {cart.map((item, idx) => {
                                        const price = Number(item?.price) || 0;
                                        const quantity = Number(item?.quantity) || 0;
                                        return (
                                            <div key={idx} className="p-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                                                <div className="w-20 h-20 bg-gray-100 rounded-md overflow-hidden flex-shrink-0 border border-gray-200">
                                                    {(() => {
                                                        const vImg = item?.options?.variantImage;
                                                        const displayImg = Array.isArray(vImg) ? vImg[0] : (vImg || item?.image);
                                                        return <img src={displayImg} alt={item?.name} className="w-full h-full object-contain mix-blend-multiply" />;
                                                    })()}
                                                </div>
                                                <div className="flex-grow">
                                                    <h3 className="font-semibold text-gray-900">{item?.name || 'Unnamed Product'}</h3>
                                                    <div className="text-sm text-gray-500 mt-1 flex flex-wrap gap-2">
                                                        {item?.options?.color && <span className="px-2 py-0.5 bg-gray-100 rounded text-xs">Color: {item.options.color}</span>}
                                                        {item?.options?.size && <span className="px-2 py-0.5 bg-gray-100 rounded text-xs">Size: {item.options.size}</span>}
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-4 mt-2 sm:mt-0">
                                                    <div className="flex items-center border border-gray-300 rounded-md">
                                                        <button onClick={() => updateQty(idx, -1)} className="px-2 py-1 hover:bg-gray-100 text-gray-600">
                                                            <div className="icon-minus text-xs"></div>
                                                        </button>
                                                        <span className="px-2 text-sm font-medium w-8 text-center">{quantity}</span>
                                                        <button onClick={() => updateQty(idx, 1)} className="px-2 py-1 hover:bg-gray-100 text-gray-600">
                                                            <div className="icon-plus text-xs"></div>
                                                        </button>
                                                    </div>
                                                    <div className="text-right min-w-[80px]">
                                                        <div className="font-bold text-gray-900">${(price * quantity).toFixed(2)}</div>
                                                        <button onClick={() => removeItem(idx)} className="text-xs text-red-500 hover:underline mt-1">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="p-6 bg-gray-50 flex justify-end">
                                    <button onClick={() => setStep(2)} className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)] w-full sm:w-auto">
                                        Proceed to Checkout
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step 2: Shipping Info */}
                        {step === 2 && (
                            <form onSubmit={handleShippingSubmit} className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                                <h2 className="text-lg font-bold text-gray-900 mb-6">Shipping Information</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={shippingInfo.fullName}
                                            onChange={e => setShippingInfo({ ...shippingInfo, fullName: e.target.value })}
                                        />
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={shippingInfo.address}
                                            onChange={e => setShippingInfo({ ...shippingInfo, address: e.target.value })}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">City</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={shippingInfo.city}
                                            onChange={e => setShippingInfo({ ...shippingInfo, city: e.target.value })}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ZIP / Postal Code</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={shippingInfo.zip}
                                            onChange={e => setShippingInfo({ ...shippingInfo, zip: e.target.value })}
                                        />
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Country</label>
                                        <select
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={shippingInfo.country}
                                            onChange={e => setShippingInfo({ ...shippingInfo, country: e.target.value })}
                                        >
                                            <option>United States</option>
                                            <option>Canada</option>
                                            <option>United Kingdom</option>
                                            <option>Australia</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="mt-8 flex justify-between">
                                    <button type="button" onClick={() => setStep(1)} className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500">Back to Cart</button>
                                    <button type="submit" className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)]">Continue to Payment</button>
                                </div>
                            </form>
                        )}

                        {/* Step 3: Payment */}
                        {step === 3 && (
                            <form onSubmit={handlePaymentSubmit} className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                                <h2 className="text-lg font-bold text-gray-900 mb-6">Payment Details</h2>

                                <div className="mb-6 p-4 bg-blue-50 text-blue-800 rounded-md text-sm border border-blue-100 flex items-start gap-2">
                                    <div className="icon-lock text-base mt-0.5"></div>
                                    <div>
                                        <span className="font-bold">Secure Payment:</span> All transactions are encrypted and secure.
                                        This is a demo, do not use real card info.
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                        <div className="relative">
                                            <input
                                                type="text"
                                                required
                                                placeholder="0000 0000 0000 0000"
                                                maxLength="19"
                                                className="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                                value={paymentInfo.cardNumber}
                                                onChange={e => setPaymentInfo({ ...paymentInfo, cardNumber: e.target.value })}
                                            />
                                            <div className="absolute left-3 top-2.5 text-gray-400">
                                                <div className="icon-credit-card"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                            <input
                                                type="text"
                                                required
                                                placeholder="MM/YY"
                                                maxLength="5"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                                value={paymentInfo.expiry}
                                                onChange={e => setPaymentInfo({ ...paymentInfo, expiry: e.target.value })}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">CVC</label>
                                            <input
                                                type="text"
                                                required
                                                placeholder="123"
                                                maxLength="3"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                                value={paymentInfo.cvc}
                                                onChange={e => setPaymentInfo({ ...paymentInfo, cvc: e.target.value })}
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="mt-8 flex justify-between">
                                    <button type="button" onClick={() => setStep(2)} className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500">Back to Shipping</button>
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className={`inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)] min-w-[140px] ${loading ? 'opacity-75 cursor-not-allowed' : ''}`}
                                    >
                                        {loading ? (
                                            <div className="icon-loader animate-spin text-xl"></div>
                                        ) : (
                                            `Pay $${total.toFixed(2)}`
                                        )}
                                    </button>
                                </div>
                            </form>
                        )}
                    </div>

                    {/* Right Column: Order Summary (Visible in Steps 1-3) */}
                    <div className="lg:col-span-4">
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-24">
                            <h2 className="text-lg font-bold text-gray-900 mb-4">Order Summary</h2>
                            <div className="space-y-3 mb-6">
                                <div className="flex justify-between text-gray-600">
                                    <span>Subtotal</span>
                                    <span>${subtotal.toFixed(2)}</span>
                                </div>
                                <div className="flex justify-between text-gray-600">
                                    <span>Shipping</span>
                                    <span>{shippingCost === 0 ? <span className="text-green-600">Free</span> : `$${shippingCost.toFixed(2)}`}</span>
                                </div>
                                <div className="flex justify-between text-gray-600">
                                    <span>Estimated Tax</span>
                                    <span>${tax.toFixed(2)}</span>
                                </div>
                                <div className="border-t border-gray-100 pt-3 flex justify-between font-bold text-lg text-gray-900">
                                    <span>Total</span>
                                    <span>${total.toFixed(2)}</span>
                                </div>
                            </div>

                            {step === 1 && (
                                <div className="text-xs text-gray-500 bg-gray-50 p-3 rounded">
                                    <div className="flex items-start gap-2">
                                        <div className="icon-truck text-gray-400 mt-0.5"></div>
                                        <div>Free shipping on orders over $100</div>
                                    </div>
                                    <div className="flex items-start gap-2 mt-2">
                                        <div className="icon-shield-check text-gray-400 mt-0.5"></div>
                                        <div>Buyer Protection Guarantee</div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        function AuthModal({ isOpen, onClose, onLogin }) {
            const [isRegistering, setIsRegistering] = React.useState(false);
            const [formData, setFormData] = React.useState({
                name: '',
                email: '',
                password: ''
            });

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                // Mock authentication
                const user = {
                    name: isRegistering ? formData.name : (formData.email.split('@')[0] || 'User'),
                    email: formData.email
                };

                // Save mock session
                localStorage.setItem('luxemarket_user', JSON.stringify(user));

                onLogin(user);
                onClose();
                setFormData({ name: '', email: '', password: '' });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] animate-[fadeIn_0.2s_ease-out]">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden relative" onClick={e => e.stopPropagation()}>
                        <button
                            onClick={onClose}
                            className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
                        >
                            <div className="icon-x text-xl"></div>
                        </button>

                        <div className="p-8">
                            <div className="text-center mb-6">
                                <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-[var(--primary-color)] mb-4">
                                    <div className="icon-user text-2xl"></div>
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900">
                                    {isRegistering ? 'Create Account' : 'Welcome Back'}
                                </h2>
                                <p className="text-gray-500 text-sm mt-1">
                                    {isRegistering ? 'Join us for exclusive deals' : 'Sign in to continue shopping'}
                                </p>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                {isRegistering && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                        <input
                                            type="text"
                                            required
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                            value={formData.name}
                                            onChange={e => setFormData({ ...formData, name: e.target.value })}
                                        />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                    <input
                                        type="email"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.email}
                                        onChange={e => setFormData({ ...formData, email: e.target.value })}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input
                                        type="password"
                                        required
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[var(--primary-color)] outline-none"
                                        value={formData.password}
                                        onChange={e => setFormData({ ...formData, password: e.target.value })}
                                    />
                                </div>

                                <button type="submit" className="w-full inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)] py-2.5 mt-2">
                                    {isRegistering ? 'Register' : 'Sign In'}
                                </button>
                            </form>

                            <div className="mt-6 text-center text-sm">
                                <span className="text-gray-500">
                                    {isRegistering ? 'Already have an account?' : 'New to LuxeMarket?'}
                                </span>
                                <button
                                    onClick={() => setIsRegistering(!isRegistering)}
                                    className="text-[var(--primary-color)] font-medium hover:underline ml-1"
                                >
                                    {isRegistering ? 'Sign In' : 'Create account'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
    </script>
    <script type="text/babel">
        // Important: DO NOT remove this `ErrorBoundary` component.
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ErrorBoundary caught an error:', error, errorInfo.componentStack);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50">
                            <div className="text-center p-8">
                                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4">
                                    <div className="icon-triangle-alert text-2xl text-red-600"></div>
                                </div>
                                <h1 className="text-2xl font-bold text-gray-900 mb-4">Something went wrong</h1>
                                <p className="text-gray-600 mb-6">We encountered an unexpected error. Please try reloading.</p>
                                <button onClick={() => window.location.reload()} className="inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-[var(--primary-color)] text-white hover:bg-[var(--primary-hover)] focus:ring-[var(--primary-color)]">Reload Page</button>
                            </div>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        function CheckoutApp() {
            const [cartCount, setCartCount] = React.useState(0);
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [currentUser, setCurrentUser] = React.useState(null);
            const [isAuthModalOpen, setIsAuthModalOpen] = React.useState(false);

            React.useEffect(() => {
                // Auth Check
                const savedUser = localStorage.getItem('luxemarket_user');
                if (savedUser) {
                    try {
                        setCurrentUser(JSON.parse(savedUser));
                    } catch (e) {
                        console.error('Failed to parse user data:', e);
                        localStorage.removeItem('luxemarket_user');
                    }
                } else {
                    // Redirect to home if not logged in (simplified protection)
                    // Or we could show the auth modal immediately
                    // For better UX, let's keep them here but they might need to login? 
                    // Actually the prompt was "user needs to either register or sign in before checking out"
                    // Since we check auth at "Add to Cart", user should be logged in here theoretically
                    // But if they access directly, we show login.
                    setIsAuthModalOpen(true);
                }

                // Initial Cart Load
                setCartCount(window.CartManager.getCount());

                // Listen for cart changes
                const handleCartUpdate = () => {
                    setCartCount(window.CartManager.getCount());
                };
                window.addEventListener('cart-updated', handleCartUpdate);
                return () => window.removeEventListener('cart-updated', handleCartUpdate);
            }, []);

            const handleLogin = (user) => setCurrentUser(user);
            const handleLogout = () => {
                localStorage.removeItem('luxemarket_user');
                setCurrentUser(null);
                window.location.href = 'index-portable.html';
            };

            return (
                <ToastProvider>
                    <div className="min-h-screen flex flex-col font-sans" data-name="checkout-app-container">
                        <Header
                            cartCount={cartCount}
                            isMenuOpen={isMenuOpen}
                            setIsMenuOpen={setIsMenuOpen}
                            currentUser={currentUser}
                            onOpenAuth={() => setIsAuthModalOpen(true)}
                            onLogout={handleLogout}
                        />

                        <main className="flex-grow py-12">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <h1 className="text-3xl font-bold text-gray-900 mb-8">Secure Checkout</h1>
                                <CheckoutFlow />
                            </div>
                        </main>

                        <Footer />

                        <AuthModal
                            isOpen={isAuthModalOpen}
                            onClose={() => setIsAuthModalOpen(false)}
                            onLogin={handleLogin}
                        />
                    </div>
                </ToastProvider>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <CheckoutApp />
            </ErrorBoundary>
        );
    </script>
</body>

</html>